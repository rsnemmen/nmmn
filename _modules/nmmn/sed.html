
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>nmmn.sed &#8212; nmmn  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/alabaster.css" />
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for nmmn.sed</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Spectral energy distributions</span>
<span class="sd">===============================</span>

<span class="sd">Methods and classes for dealing with spectral energy distributions (SEDs).</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">numpy</span><span class="o">,</span> <span class="nn">pylab</span><span class="o">,</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">scipy</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">lsd</span> <span class="c1"># intrapackage reference</span>
<span class="kn">import</span> <span class="nn">astropy.io.ascii</span> <span class="k">as</span> <span class="nn">ascii</span>



<div class="viewcode-block" id="SED"><a class="viewcode-back" href="../../nmmn.html#nmmn.sed.SED">[docs]</a><span class="k">class</span> <span class="nc">SED</span><span class="p">:</span>
<span class="w">	</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Class that defines objects storing Spectral energy distributions (SEDs). </span>
<span class="sd">	The SEDs can be imported either from datafiles with the observations/models,</span>
<span class="sd">	or from arrays with the values of log(nu) and log(nuLnu).</span>
<span class="sd">	</span>
<span class="sd">	The object&#39;s initial attributes are:</span>

<span class="sd">	- nu: frequency in Hertz</span>
<span class="sd">	- lognu: log10(frequency)</span>
<span class="sd">	- nlnu: nu L_nu in erg/s</span>
<span class="sd">	- ll: log10(nu Lnu)</span>
<span class="sd">	- file : input datafile</span>
<span class="sd">	</span>
<span class="sd">	To import a SED from an ASCII file:</span>

<span class="sd">	&gt;&gt;&gt; s=sed.SED(file=datafile, logfmt=XX)</span>

<span class="sd">	where logfmt is 1 if the data is already in logarithm or 0 otherwise.</span>
<span class="sd">	NOTE: logfmt for now is by default 0 (Eracleous&#39; SEDs).</span>
<span class="sd">	</span>
<span class="sd">	To create a SED object from the arrays lognu and lognulnu:</span>

<span class="sd">	&gt;&gt;&gt; s=sed.SED(lognu=lognu, ll=lognulnu)</span>
<span class="sd">	</span>
<span class="sd">	To import a SED in a special format:</span>

<span class="sd">	&gt;&gt;&gt; s=sed.SED()</span>
<span class="sd">	&gt;&gt;&gt; s.erac(&#39;ngc1097.dat&#39;)</span>
<span class="sd">	</span>
<span class="sd">	To plot the SED:</span>

<span class="sd">	&gt;&gt;&gt; plot(s.lognu, s.ll)</span>
<span class="sd">	</span>
<span class="sd">	To calculate the bolometric luminosity:</span>

<span class="sd">	&gt;&gt;&gt; s.bol()</span>
<span class="sd">	</span>
<span class="sd">	after which the value will be stored in s.lumbol	</span>
<span class="sd">	&quot;&quot;&quot;</span>
		
	<span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">logfmt</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">lognu</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ll</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	To import a SED from an ASCII file:</span>
<span class="sd">	&gt;&gt;&gt; s=sed.SED(file=XX, logfmt=XX)</span>
<span class="sd">	where logfmt is 1 if the data is already in logarithm or 0 otherwise.</span>
<span class="sd">	NOTE: logfmt for now is by default 0 (e.g. Eracleous&#39; SEDs).</span>
<span class="sd">	</span>
<span class="sd">	To create a SED object from the arrays lognu and lognulnu:</span>

<span class="sd">	&gt;&gt;&gt; s=sed.SED(lognu=lognu, ll=lognulnu)</span>
<span class="sd">	</span>
<span class="sd">	&gt;&gt;&gt; s=sed.SED()</span>

<span class="sd">	creates an empty SED object. Then you can call specific methods to handle</span>
<span class="sd">	SEDs in special formats (e.g. s.erac).</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">=</span><span class="n">file</span>	<span class="c1"># input datafile (string) from which the observed spectrum was imported</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">lognu</span><span class="o">=</span><span class="n">lognu</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">ll</span><span class="o">=</span><span class="n">ll</span>

		<span class="c1"># If the SED is imported from a file...</span>
		<span class="k">if</span> <span class="n">file</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">logfmt</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
				<span class="c1"># Reads SED from datafile</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">nu</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">nlnu</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">file</span><span class="p">,</span><span class="n">unpack</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">usecols</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
		
				<span class="c1"># Take logs</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">lognu</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ll</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nu</span><span class="p">),</span> <span class="n">numpy</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nlnu</span><span class="p">)</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">lognu</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ll</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">file</span><span class="p">,</span><span class="n">unpack</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">usecols</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">nu</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">nlnu</span> <span class="o">=</span> <span class="mf">10.</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">lognu</span><span class="p">,</span> <span class="mf">10.</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">ll</span>

		<span class="c1"># If the SED is created from the arrays</span>
		<span class="k">if</span> <span class="n">file</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">lognu</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">logfmt</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">lognu</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ll</span> <span class="o">=</span> <span class="n">lognu</span><span class="p">,</span> <span class="n">ll</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">nu</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">nlnu</span> <span class="o">=</span> <span class="mf">10.</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">lognu</span><span class="p">,</span> <span class="mf">10.</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">ll</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">nu</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nlnu</span> <span class="o">=</span> <span class="n">lognu</span><span class="p">,</span> <span class="n">ll</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">lognu</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ll</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lognu</span><span class="p">),</span> <span class="n">numpy</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ll</span><span class="p">)</span>
		
		<span class="c1"># Checks if ll has NaN or Inf values</span>
		<span class="k">if</span> <span class="n">file</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">lognu</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">check</span><span class="p">()</span>



<div class="viewcode-block" id="SED.erac"><a class="viewcode-back" href="../../nmmn.html#nmmn.sed.SED.erac">[docs]</a>	<span class="k">def</span> <span class="nf">erac</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Reads SEDs in the format provided by Eracleous et al. LINER SEDs:</span>
<span class="sd">		nu	nuLnu	nuLnu(extinction)	error	upperLimit?(0/1)</span>
<span class="sd">		</span>
<span class="sd">		Adds the following attributes to the SED object:</span>
<span class="sd">		- nlnuex: nuLnu after extinction correction</span>
<span class="sd">		- llex: log10(nuLnu) after extinction correction</span>
<span class="sd">		- ul: is the datapoint an upper limit (arrow)? 1 if yes, 0 if not</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">=</span><span class="n">file</span>
		
		<span class="bp">self</span><span class="o">.</span><span class="n">nu</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">nlnu</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">nlnuex</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ul</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">file</span><span class="p">,</span><span class="n">unpack</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">usecols</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">lognu</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ll</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nu</span><span class="p">),</span> <span class="n">numpy</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nlnu</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">llex</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nlnuex</span><span class="p">)</span>
		
		<span class="c1"># Checks if ll has NaN or Inf values</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">check</span><span class="p">()</span></div>




<div class="viewcode-block" id="SED.hayden"><a class="viewcode-back" href="../../nmmn.html#nmmn.sed.SED.hayden">[docs]</a>	<span class="k">def</span> <span class="nf">hayden</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file</span><span class="p">,</span> <span class="n">dist</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Reads SEDs in the format provided by Hampadarath et al.:</span>
<span class="sd">	nu(GHz) flux(microJy) error(microJy) Detection[1]orUpperlimit[0]</span>
<span class="sd">		</span>
<span class="sd">		Adds the following attributes to the SED object:</span>
<span class="sd">		- ul: is the datapoint an upper limit (arrow)? 1 if yes, 0 if not</span>
<span class="sd">		- distance: distance to object in Mpc</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">=</span><span class="n">file</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">distance</span><span class="o">=</span><span class="n">dist</span>
		
		<span class="bp">self</span><span class="o">.</span><span class="n">nu</span><span class="p">,</span><span class="n">flux</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ul</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">file</span><span class="p">,</span><span class="n">unpack</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">usecols</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
		<span class="n">flux</span><span class="o">=</span><span class="n">flux</span><span class="o">*</span><span class="mf">1e-26</span><span class="o">*</span><span class="mf">1e-6</span><span class="o">*</span><span class="mf">1e7</span><span class="o">*</span><span class="mf">1e-4</span>	<span class="c1"># microJy to erg/s/cm^2/Hz</span>
		<span class="n">dist</span><span class="o">=</span><span class="n">dist</span><span class="o">*</span><span class="mf">3.086e24</span>	<span class="c1"># Mpc to cm</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">lnu</span><span class="o">=</span><span class="mf">4.</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">dist</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">flux</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">lognu</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nu</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">ll</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lnu</span><span class="p">)</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">lognu</span>
		

		<span class="c1"># inverts the convention for upper limits, to be consistent with my</span>
		<span class="c1"># previous one (Hayden adopts the inverse convention)</span>
		<span class="n">x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ul</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
		<span class="n">x</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ul</span><span class="o">==</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span>
		<span class="n">x</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ul</span><span class="o">==</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">ul</span><span class="o">=</span><span class="n">x</span>

		<span class="c1"># Checks if ll has NaN or Inf values</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">check</span><span class="p">()</span></div>



<div class="viewcode-block" id="SED.prieto"><a class="viewcode-back" href="../../nmmn.html#nmmn.sed.SED.prieto">[docs]</a>	<span class="k">def</span> <span class="nf">prieto</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file</span><span class="p">,</span> <span class="n">dist</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Reads SEDs in the format provided by Hampadarath et al.:</span>
<span class="sd">	nu(Hz) nu*F_nu(Jy Hz) </span>
<span class="sd">		</span>
<span class="sd">		Adds the following attributes to the SED object:</span>
<span class="sd">		- distance: distance to object in Mpc</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">=</span><span class="n">file</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">distance</span><span class="o">=</span><span class="n">dist</span>

		<span class="bp">self</span><span class="o">.</span><span class="n">lognu</span><span class="p">,</span><span class="n">nfn</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">file</span><span class="p">,</span><span class="n">unpack</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">usecols</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">nu</span><span class="o">=</span><span class="mi">10</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">lognu</span>
		<span class="n">nfn</span><span class="o">=</span><span class="mi">10</span><span class="o">**</span><span class="n">nfn</span><span class="o">*</span><span class="mf">1e-26</span><span class="o">*</span><span class="mf">1e7</span><span class="o">*</span><span class="mf">1e-4</span>	<span class="c1"># Jy to erg/s/cm^2</span>
		<span class="n">dist</span><span class="o">=</span><span class="n">dist</span><span class="o">*</span><span class="mf">3.086e24</span>	<span class="c1"># Mpc to cm</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">ll</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="mf">4.</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">dist</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">nfn</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">lnu</span><span class="o">=</span><span class="mi">10</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">ll</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">nu</span>

		<span class="c1"># Checks if ll has NaN or Inf values</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">check</span><span class="p">()</span></div>



<div class="viewcode-block" id="SED.grmonty"><a class="viewcode-back" href="../../nmmn.html#nmmn.sed.SED.grmonty">[docs]</a>	<span class="k">def</span> <span class="nf">grmonty</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Reads SEDs in the format provided by grmonty. I ported the </span>
<span class="sd">		original SM script `plspec.m` provided by J. Dolence. </span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="c1"># reads grmonty SED file</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">=</span><span class="n">file</span>
		<span class="n">s</span><span class="o">=</span><span class="n">ascii</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">Reader</span><span class="o">=</span><span class="n">ascii</span><span class="o">.</span><span class="n">NoHeader</span><span class="p">)</span>

		<span class="c1"># carries out array conversions</span>
		<span class="n">small</span> <span class="o">=</span> <span class="mf">1e-12</span>
		<span class="n">ll0</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="s1">&#39;col2&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">small</span><span class="p">)</span> <span class="o">+</span> <span class="n">numpy</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="mf">3.83e33</span><span class="p">)</span>
		<span class="n">ll1</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="s1">&#39;col8&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">small</span><span class="p">)</span> <span class="o">+</span> <span class="n">numpy</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="mf">3.83e33</span><span class="p">)</span>
		<span class="n">ll2</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="s1">&#39;col14&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">small</span><span class="p">)</span> <span class="o">+</span> <span class="n">numpy</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="mf">3.83e33</span><span class="p">)</span>
		<span class="n">ll3</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="s1">&#39;col20&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">small</span><span class="p">)</span> <span class="o">+</span> <span class="n">numpy</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="mf">3.83e33</span><span class="p">)</span>
		<span class="n">ll4</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="s1">&#39;col26&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">small</span><span class="p">)</span> <span class="o">+</span> <span class="n">numpy</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="mf">3.83e33</span><span class="p">)</span>
		<span class="n">ll5</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="s1">&#39;col32&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">small</span><span class="p">)</span> <span class="o">+</span> <span class="n">numpy</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="mf">3.83e33</span><span class="p">)</span>
		<span class="n">lw</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="s1">&#39;col1&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">numpy</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="mf">9.1e-28</span><span class="o">*</span><span class="mf">3e10</span><span class="o">*</span><span class="mf">3e10</span><span class="o">/</span><span class="mf">6.626e-27</span><span class="p">)</span>

		<span class="c1"># gets log(nu) and log(nuLnu)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">lognu</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ll</span> <span class="o">=</span> <span class="n">lw</span><span class="p">,</span> <span class="n">ll5</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">nu</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">nlnu</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">lognu</span><span class="p">,</span><span class="mi">10</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">ll</span>
		
		<span class="c1"># Checks if ll has NaN or Inf values</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">check</span><span class="p">()</span></div>


<div class="viewcode-block" id="SED.raniere"><a class="viewcode-back" href="../../nmmn.html#nmmn.sed.SED.raniere">[docs]</a>	<span class="k">def</span> <span class="nf">raniere</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file</span><span class="p">,</span> <span class="n">dist</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Reads SEDs in the format provided by Hampadarath et al.:</span>
<span class="sd">		nu(GHz) flux(microJy) error(microJy) Detection[1]orUpperlimit[0]</span>

<span class="sd">		:param file: file with SED data</span>
<span class="sd">		:param dist: distance in Mpc</span>

<span class="sd">		:returns: SED object in units of Hz vs erg/s</span>

<span class="sd">		Adds the following attributes to the SED object:</span>
<span class="sd">		- ul: is the datapoint an upper limit (arrow)? 1 if yes, 0 if not</span>
<span class="sd">		- distance: distance to object in Mpc</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">=</span><span class="n">file</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">distance</span><span class="o">=</span><span class="n">dist</span>

		<span class="n">f</span><span class="o">=</span><span class="n">ascii</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>  
		
		<span class="n">nu</span><span class="o">=</span><span class="n">f</span><span class="p">[</span><span class="s1">&#39;col3&#39;</span><span class="p">]</span>	<span class="c1"># GHz </span>
		<span class="n">flux</span><span class="o">=</span><span class="n">f</span><span class="p">[</span><span class="s1">&#39;col4&#39;</span><span class="p">]</span>	<span class="c1"># v*F(v)(flux) [W.m-2]</span>
		<span class="n">fluxerr</span><span class="o">=</span><span class="n">f</span><span class="p">[</span><span class="s1">&#39;col5&#39;</span><span class="p">]</span>	<span class="c1"># flux error, if 999999 then this is an upper limit with 95 confidence</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">observatories</span><span class="o">=</span><span class="n">f</span><span class="p">[</span><span class="s1">&#39;col2&#39;</span><span class="p">]</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">references</span><span class="o">=</span><span class="n">f</span><span class="p">[</span><span class="s1">&#39;col1&#39;</span><span class="p">]</span>
		
		<span class="c1"># preprocessing</span>
		<span class="n">dist</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">distance</span><span class="o">*</span><span class="mf">3.086e24</span>	<span class="c1"># Mpc to cm</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">nu</span><span class="o">=</span><span class="n">nu</span><span class="o">*</span><span class="mf">1e9</span> <span class="c1"># GHz =&gt; Hz		</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">nlnu</span><span class="o">=</span><span class="n">flux</span><span class="o">*</span><span class="mi">4</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">dist</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="mi">1000</span>	<span class="c1"># to erg/s</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">nlnuerr</span><span class="o">=</span><span class="n">fluxerr</span><span class="o">*</span><span class="mi">4</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">dist</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="mi">1000</span>	<span class="c1"># to erg/s</span>

		<span class="bp">self</span><span class="o">.</span><span class="n">lognu</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nu</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">ll</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nlnu</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">llerr</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ll</span><span class="o">-</span><span class="n">numpy</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nlnuerr</span><span class="p">))</span>
		
		<span class="c1"># inverts the convention for upper limits, to be consistent with my</span>
		<span class="c1"># previous one (Hayden adopts the inverse convention)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">ul</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nu</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">ul</span><span class="p">[</span><span class="n">fluxerr</span><span class="o">==</span><span class="mi">999999</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

		<span class="c1"># Checks if ll has NaN or Inf values</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">check</span><span class="p">()</span></div>








<div class="viewcode-block" id="SED.haydenx"><a class="viewcode-back" href="../../nmmn.html#nmmn.sed.SED.haydenx">[docs]</a>	<span class="k">def</span> <span class="nf">haydenx</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Reads X-ray data in the format provided by F. Panessa:</span>
<span class="sd">		nu	error_nu nuLnu	error	?</span>
<span class="sd">		</span>
<span class="sd">		Adds the following attributes to the SED object:</span>
<span class="sd">		- ul: is the datapoint an upper limit (arrow)? 1 if yes, 0 if not</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">=</span><span class="n">file</span>
		
		<span class="bp">self</span><span class="o">.</span><span class="n">lognu</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">lognuerr</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ll</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">llerr</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">file</span><span class="p">,</span><span class="n">unpack</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">usecols</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">lognuerr</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lognu</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">lognuerr</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">llerr</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ll</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">llerr</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">ul</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ll</span><span class="p">)</span>
		
		<span class="c1"># Checks if ll has NaN or Inf values</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">check</span><span class="p">()</span></div>










<div class="viewcode-block" id="SED.check"><a class="viewcode-back" href="../../nmmn.html#nmmn.sed.SED.check">[docs]</a>	<span class="k">def</span> <span class="nf">check</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Checks whether there are NaN or Inf values in the array log10(nuLnu).</span>
<span class="sd">	If so, displays a warning to the user and the corresponding filename.</span>
<span class="sd">	Method called by initialization methods init and erac.</span>
<span class="sd">	</span>
<span class="sd">	Creates a new attribute, weird, which is 1 if there are NaN or Inf values,</span>
<span class="sd">	and 0 otherwise.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">if</span> <span class="kc">False</span> <span class="ow">in</span> <span class="n">numpy</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ll</span><span class="p">):</span>
			<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Warning: NaN or Inf in the Lnu array! &#39;</span><span class="p">),</span>
			<span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="p">)</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">weird</span><span class="o">=</span><span class="mi">1</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">weird</span><span class="o">=</span><span class="mi">0</span></div>








<div class="viewcode-block" id="SED.sort"><a class="viewcode-back" href="../../nmmn.html#nmmn.sed.SED.sort">[docs]</a>	<span class="k">def</span> <span class="nf">sort</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	&gt;&gt;&gt; s.sort()</span>

<span class="sd">	Sorts the SED in ascending order of frequencies.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="c1"># Index of sorted elements</span>
		<span class="n">i</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lognu</span><span class="o">.</span><span class="n">argsort</span><span class="p">()</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">nu</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">nlnu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nu</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">nlnu</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">lognu</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ll</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lognu</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">ll</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
		
		<span class="c1"># Precaution in case the user used the interp method</span>
		<span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;nlnui&#39;</span><span class="p">):</span> 
			<span class="bp">self</span><span class="o">.</span><span class="n">nui</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">nlnui</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nui</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">nlnui</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">lognui</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">lli</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lognui</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">lli</span><span class="p">[</span><span class="n">i</span><span class="p">]</span></div>
		

		
<div class="viewcode-block" id="SED.unit"><a class="viewcode-back" href="../../nmmn.html#nmmn.sed.SED.unit">[docs]</a>	<span class="k">def</span> <span class="nf">unit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&quot;&quot;&quot;Normalizes the spectrum to one.&quot;&quot;&quot;</span>

		<span class="c1"># Precaution in case the user did not use the interp method</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;nlnui&#39;</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">interp</span><span class="p">()</span>
	
		<span class="bp">self</span><span class="o">.</span><span class="n">nlnu</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nlnu</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">nlnu</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">ll</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nlnu</span><span class="p">)</span>
		
		<span class="c1"># Normalizes the interpolated values</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">nlnui</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nlnui</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">nlnui</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">lli</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nlnui</span><span class="p">)</span></div>






<div class="viewcode-block" id="SED.write"><a class="viewcode-back" href="../../nmmn.html#nmmn.sed.SED.write">[docs]</a>	<span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Exports the SED as an ASCII file with the structure:</span>
<span class="sd">		col1=log10(nu/Hz), col2=log10(nu Lnu / erg per sec)</span>
<span class="sd">		</span>
<span class="sd">		&gt;&gt;&gt; s.write(file)</span>

<span class="sd">		exports the SED s as the file &quot;file&quot;</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">numpy</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">file</span><span class="p">,</span><span class="n">numpy</span><span class="o">.</span><span class="n">transpose</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">lognu</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ll</span><span class="p">)))</span></div>






<div class="viewcode-block" id="SED.interp"><a class="viewcode-back" href="../../nmmn.html#nmmn.sed.SED.interp">[docs]</a>	<span class="k">def</span> <span class="nf">interp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seds</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">points</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">xrange</span><span class="o">=</span><span class="p">[</span><span class="mi">8</span><span class="p">,</span><span class="mi">22</span><span class="p">]):</span>
<span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Interpolates the SED and a list of SEDs (optional) in the given range</span>
<span class="sd">	of values of log(nu) and for the given number of points.</span>
<span class="sd">	</span>
<span class="sd">	&gt;&gt;&gt; s.interp([s,s1,s2])</span>
<span class="sd">	interpolates s, s1 and s2 with 1000 points in the range</span>
<span class="sd">	log(nu)=8-22 (Hz). s, s1 and s2 are also instances of the class SED. The</span>
<span class="sd">	interpolated arrays (lognui, lli, nui, nlnui) will be added as new </span>
<span class="sd">	attributes to each object. If given no argument, will interpolate the</span>
<span class="sd">	current SED object.</span>
<span class="sd">	</span>
<span class="sd">	:param seds: list of SED objects to interpolate</span>
<span class="sd">	:param points: number of interpolated points</span>
<span class="sd">	:param xrange: list in the form [xinitial, xfinal] with the x-range of interpolation. </span>
<span class="sd">	</span>
<span class="sd">	If provided with no list of SEDs (e.g., s.interp()), then the method</span>
<span class="sd">	interpolates only the current SED s. If provided with no xrange argument,</span>
<span class="sd">	it will by default assume the range [8,22] discarding data points outside</span>
<span class="sd">	that range in the interpolation, hence adjust accordingly.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="c1"># If seds==None, then the method operates only on the object itself </span>
		<span class="c1"># (e.g., s.interp()) and proper actions are taken to avoid problems</span>
		<span class="k">if</span> <span class="n">seds</span><span class="o">==</span><span class="kc">None</span><span class="p">:</span>
			<span class="c1"># Defines the new array of interpolated frequencies (with a </span>
			<span class="c1"># preferentially large number of points)</span>
			<span class="n">xold</span><span class="p">,</span> <span class="n">yold</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lognu</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ll</span>
			<span class="n">xnew</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">xrange</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">xrange</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">points</span><span class="p">)</span>
			<span class="n">ynew</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">xnew</span><span class="p">,</span><span class="n">xold</span><span class="p">,</span><span class="n">yold</span><span class="p">,</span><span class="n">left</span><span class="o">=-</span><span class="mi">20</span><span class="p">,</span><span class="n">right</span><span class="o">=-</span><span class="mi">20</span><span class="p">)</span>

			<span class="c1"># Interpolates the current SED (simple linear interpolation).</span>
			<span class="c1"># Interpolated y-values outside the original x-range are zeroes (-20</span>
			<span class="c1"># in log space of luminosities).			</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">lognui</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lli</span> <span class="o">=</span> <span class="n">xnew</span><span class="p">,</span> <span class="n">ynew</span>	<span class="c1"># log scale</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">nui</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nlnui</span> <span class="o">=</span> <span class="mf">10.</span><span class="o">**</span><span class="n">xnew</span><span class="p">,</span> <span class="mf">10.</span><span class="o">**</span><span class="n">ynew</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="c1"># Interpolates the other SEDs with the same binning. But only does</span>
			<span class="c1"># that if a list of SEDs was actually provided!</span>
			<span class="k">for</span> <span class="n">sed</span> <span class="ow">in</span> <span class="n">seds</span><span class="p">:</span>
				<span class="n">xold</span><span class="p">,</span> <span class="n">yold</span> <span class="o">=</span> <span class="n">sed</span><span class="o">.</span><span class="n">lognu</span><span class="p">,</span> <span class="n">sed</span><span class="o">.</span><span class="n">ll</span>
				<span class="n">xnew</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">xrange</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">xrange</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">points</span><span class="p">)</span>
				<span class="n">ynew</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">xnew</span><span class="p">,</span><span class="n">xold</span><span class="p">,</span><span class="n">yold</span><span class="p">,</span><span class="n">left</span><span class="o">=-</span><span class="mi">20</span><span class="p">,</span><span class="n">right</span><span class="o">=-</span><span class="mi">20</span><span class="p">)</span>
			
				<span class="n">sed</span><span class="o">.</span><span class="n">lognui</span><span class="p">,</span> <span class="n">sed</span><span class="o">.</span><span class="n">lli</span> <span class="o">=</span> <span class="n">xnew</span><span class="p">,</span> <span class="n">ynew</span>	<span class="c1"># log scale</span>
				<span class="n">sed</span><span class="o">.</span><span class="n">nui</span><span class="p">,</span> <span class="n">sed</span><span class="o">.</span><span class="n">nlnui</span> <span class="o">=</span> <span class="mf">10.</span><span class="o">**</span><span class="n">xnew</span><span class="p">,</span> <span class="mf">10.</span><span class="o">**</span><span class="n">ynew</span></div>




		



	
	
	
<div class="viewcode-block" id="SED.normalize"><a class="viewcode-back" href="../../nmmn.html#nmmn.sed.SED.normalize">[docs]</a>	<span class="k">def</span> <span class="nf">normalize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seds</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">nuref</span><span class="o">=</span><span class="mf">17.684</span><span class="p">,</span> <span class="n">refnlnu</span><span class="o">=</span><span class="mf">1e40</span><span class="p">,</span> <span class="n">xray</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Normalizes a SED at the given frequency (lognu/Hz) and nuLnu (erg/s). </span>
<span class="sd">	NOTE: this will modify the SED(s). Alternatively, if the user provides </span>
<span class="sd">	the argument xray=True, then the method normalizes the SEDs such that </span>
<span class="sd">	they have the same X-ray luminosity refnlnu in the range 2-10 keV </span>
<span class="sd">	(thus ignoring the arg.	nuref).</span>
<span class="sd">	</span>
<span class="sd">	&gt;&gt;&gt; s.normalize([s1,s2,s3])</span>

<span class="sd">	normalizes the SEDs in the object list at the same frequency and nuLnu</span>
<span class="sd">	</span>
<span class="sd">	&gt;&gt;&gt; s.normalize([s1,s2,s3],refnlnu=1e40,xray=True)</span>

<span class="sd">	normalizes the SEDs such that they have the same X-ray luminosity 1e40 </span>
<span class="sd">	erg/s in the range 2-10 keV.</span>
<span class="sd">	</span>
<span class="sd">	The method is designed to automatically call the interp method (e.g., </span>
<span class="sd">	s.interp([s1,s2])) if needed.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="c1"># Precaution in case the user did not use the interp method</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;nlnui&#39;</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">seds</span><span class="p">)</span>
		
		<span class="c1"># If seds==None, then the method operates on the object itself, </span>
		<span class="c1"># otherwise it operates on a list of objects</span>
		<span class="k">if</span> <span class="n">seds</span><span class="o">==</span><span class="kc">None</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">xray</span><span class="o">==</span><span class="kc">None</span><span class="p">:</span>	<span class="c1"># if xray keyword is not provided</span>
				<span class="c1"># Finds the nuLnu corresponding to the frequency nearest nuref.</span>
				<span class="c1"># Uses the interpolated arrays for this purpose.</span>
				<span class="n">i</span><span class="o">=</span><span class="n">lsd</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">nuref</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lognui</span><span class="p">)</span>
			
				<span class="bp">self</span><span class="o">.</span><span class="n">nlnu</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nlnu</span><span class="o">*</span><span class="n">refnlnu</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">nlnui</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">nlnui</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nlnui</span><span class="o">*</span><span class="n">refnlnu</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">nlnui</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">lli</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nlnui</span><span class="p">)</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">ll</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nlnu</span><span class="p">)</span>
			<span class="k">else</span><span class="p">:</span>	<span class="c1"># if xray keyword IS provided</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">xrays</span><span class="p">()</span>
				<span class="n">factor</span><span class="o">=</span><span class="n">refnlnu</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">lumx</span>	<span class="c1"># normalization factor</span>
				
				<span class="bp">self</span><span class="o">.</span><span class="n">nlnu</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nlnu</span><span class="o">*</span><span class="n">factor</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">nlnui</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nlnui</span><span class="o">*</span><span class="n">factor</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">lli</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nlnui</span><span class="p">)</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">ll</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nlnu</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">for</span> <span class="n">sed</span> <span class="ow">in</span> <span class="n">seds</span><span class="p">:</span>
				<span class="k">if</span> <span class="n">xray</span><span class="o">==</span><span class="kc">None</span><span class="p">:</span>	<span class="c1"># if xray keyword is not provided</span>
					<span class="n">i</span><span class="o">=</span><span class="n">lsd</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">nuref</span><span class="p">,</span> <span class="n">sed</span><span class="o">.</span><span class="n">lognui</span><span class="p">)</span>
			
					<span class="n">sed</span><span class="o">.</span><span class="n">nlnu</span><span class="o">=</span><span class="n">sed</span><span class="o">.</span><span class="n">nlnu</span><span class="o">*</span><span class="n">refnlnu</span><span class="o">/</span><span class="n">sed</span><span class="o">.</span><span class="n">nlnui</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
					<span class="n">sed</span><span class="o">.</span><span class="n">nlnui</span><span class="o">=</span><span class="n">sed</span><span class="o">.</span><span class="n">nlnui</span><span class="o">*</span><span class="n">refnlnu</span><span class="o">/</span><span class="n">sed</span><span class="o">.</span><span class="n">nlnui</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
					<span class="n">sed</span><span class="o">.</span><span class="n">lli</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">sed</span><span class="o">.</span><span class="n">nlnui</span><span class="p">)</span>
					<span class="n">sed</span><span class="o">.</span><span class="n">ll</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">sed</span><span class="o">.</span><span class="n">nlnu</span><span class="p">)</span>
				<span class="k">else</span><span class="p">:</span>	<span class="c1"># if xray keyword IS provided</span>
					<span class="n">sed</span><span class="o">.</span><span class="n">xrays</span><span class="p">()</span>
					<span class="n">factor</span><span class="o">=</span><span class="n">refnlnu</span><span class="o">/</span><span class="n">sed</span><span class="o">.</span><span class="n">lumx</span>	<span class="c1"># normalization factor</span>
				
					<span class="n">sed</span><span class="o">.</span><span class="n">nlnu</span><span class="o">=</span><span class="n">sed</span><span class="o">.</span><span class="n">nlnu</span><span class="o">*</span><span class="n">factor</span>
					<span class="n">sed</span><span class="o">.</span><span class="n">nlnui</span><span class="o">=</span><span class="n">sed</span><span class="o">.</span><span class="n">nlnui</span><span class="o">*</span><span class="n">factor</span>
					<span class="n">sed</span><span class="o">.</span><span class="n">lli</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">sed</span><span class="o">.</span><span class="n">nlnui</span><span class="p">)</span>
					<span class="n">sed</span><span class="o">.</span><span class="n">ll</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">sed</span><span class="o">.</span><span class="n">nlnu</span><span class="p">)</span></div>
		

		
		
		
		
<div class="viewcode-block" id="SED.meanlin"><a class="viewcode-back" href="../../nmmn.html#nmmn.sed.SED.meanlin">[docs]</a>	<span class="k">def</span> <span class="nf">meanlin</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seds</span><span class="p">,</span> <span class="n">nuref</span><span class="o">=</span><span class="mf">17.684</span><span class="p">,</span> <span class="n">refnlnu</span><span class="o">=</span><span class="mf">1e40</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Given a list of SEDs and a reference value of log10(nu), normalizes the </span>
<span class="sd">	SEDs (s.normalize) at the given nuref and refnlnu, calculates the average </span>
<span class="sd">	of their luminosities (log10(average nuLnu)) and returns the list [mean,sd] </span>
<span class="sd">	where &#39;mean&#39; is SED object with the mean and &#39;sd&#39; is the object with the</span>
<span class="sd">	standard deviation.</span>
<span class="sd">	</span>
<span class="sd">	&gt;&gt;&gt; mean=s.meanlin([s1,s2],17.684,1e40)</span>
<span class="sd">	returns mean &lt;- [lognu, &lt;s1,s2&gt;],</span>
<span class="sd">	where &lt;s,s1,s2&gt; -&gt; log10[&lt;nuLnu(s),nuLnu(s1),nuLnu(s2)&gt;], lognu being the common </span>
<span class="sd">	units of frequency for the SEDs after interpolation.</span>
<span class="sd">		&quot;&quot;&quot;</span>	
		<span class="bp">self</span><span class="o">.</span><span class="n">normalize</span><span class="p">(</span><span class="n">seds</span><span class="p">,</span><span class="n">nuref</span><span class="p">,</span><span class="n">refnlnu</span><span class="p">)</span>	<span class="c1"># normalize them to a common nu</span>
		
		<span class="n">s</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">seds</span><span class="p">)</span>
		<span class="n">lognu</span><span class="o">=</span><span class="n">s</span><span class="o">.</span><span class="n">lognu</span>
		<span class="n">m</span><span class="o">=</span><span class="n">s</span><span class="o">.</span><span class="n">nlnu</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">seds</span><span class="p">)</span>	<span class="c1"># takes the average</span>
		
		<span class="c1"># Computes the standard deviation</span>
		<span class="n">sd</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>	<span class="c1"># initializes the sd array		</span>
		<span class="k">for</span> <span class="n">sed</span> <span class="ow">in</span> <span class="n">seds</span><span class="p">:</span>
			<span class="n">sd</span><span class="o">=</span><span class="n">sd</span><span class="o">+</span><span class="p">(</span><span class="n">sed</span><span class="o">.</span><span class="n">nlnui</span><span class="o">-</span><span class="n">m</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
		<span class="n">sd</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">sd</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">seds</span><span class="p">))</span>
		
		<span class="n">meansed</span><span class="o">=</span><span class="n">SED</span><span class="p">(</span><span class="n">lognu</span><span class="o">=</span><span class="n">lognu</span><span class="p">,</span> <span class="n">ll</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">m</span><span class="p">),</span> <span class="n">logfmt</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
		<span class="n">sdsed</span><span class="o">=</span><span class="n">SED</span><span class="p">(</span><span class="n">lognu</span><span class="o">=</span><span class="n">lognu</span><span class="p">,</span> <span class="n">ll</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">sd</span><span class="p">),</span> <span class="n">logfmt</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
		
		<span class="k">return</span> <span class="p">[</span><span class="n">meansed</span><span class="p">,</span><span class="n">sdsed</span><span class="p">]</span>		</div>
		<span class="c1">#return SED(lognu=lognu, ll=numpy.log10(m))</span>
		





		
<div class="viewcode-block" id="SED.mean"><a class="viewcode-back" href="../../nmmn.html#nmmn.sed.SED.mean">[docs]</a>	<span class="k">def</span> <span class="nf">mean</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seds</span><span class="p">,</span> <span class="n">nuref</span><span class="o">=</span><span class="mf">17.684</span><span class="p">,</span> <span class="n">refnlnu</span><span class="o">=</span><span class="mf">1e40</span><span class="p">,</span> <span class="n">xray</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Given a list of SEDs and a reference value of log10(nu), normalizes the </span>
<span class="sd">	SEDs (s.normalize) at the given nuref and refnlnu, calculates the average </span>
<span class="sd">	of their luminosities (average(log10(nuLnu)), like Eracleous et al. 2010 does) </span>
<span class="sd">	and returns the list [mean,sd] where &#39;mean&#39; is SED object with the mean and </span>
<span class="sd">	&#39;sd&#39; is the object with the	standard deviation.</span>
<span class="sd">	</span>
<span class="sd">	Alternatively, if the user provides the argument xray=True, then</span>
<span class="sd">	the method normalizes the SEDs such that they have the same X-ray</span>
<span class="sd">	luminosity refnlnu in the range 2-10 keV (thus ignoring the arg.</span>
<span class="sd">	nuref).</span>
<span class="sd">	</span>
<span class="sd">	&gt;&gt;&gt; means=s.mean([s1,s2],17.684,1e40)</span>

<span class="sd">	returns mean &lt;- [lognu, &lt;s1,s2&gt;],</span>
<span class="sd">	where &lt;s,s1,s2&gt; -&gt; &lt;log10[nuLnu(s),nuLnu(s1),nuLnu(s2)]&gt;, lognu being the common </span>
<span class="sd">	units of frequency for the SEDs after interpolation.</span>
<span class="sd">	</span>
<span class="sd">	&gt;&gt;&gt; means=s.mean([s1,s2],refnlnu=1e40,xray=True)</span>

<span class="sd">	returns the mean after normalizing the SEDs to the X-ray lum.</span>
<span class="sd">	1e40 erg/s in the range 2-10 keV.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">normalize</span><span class="p">(</span><span class="n">seds</span><span class="p">,</span><span class="n">nuref</span><span class="p">,</span><span class="n">refnlnu</span><span class="p">,</span><span class="n">xray</span><span class="p">)</span>	<span class="c1"># normalize them to a common nu</span>
			
		<span class="c1"># Sum the values of log10(nuLnu)</span>
		<span class="n">sums</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">seds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lli</span><span class="p">)</span>	<span class="c1"># initializes the sum</span>
		<span class="k">for</span> <span class="n">sed</span> <span class="ow">in</span> <span class="n">seds</span><span class="p">:</span>
			<span class="n">sums</span><span class="o">=</span><span class="n">sums</span><span class="o">+</span><span class="n">sed</span><span class="o">.</span><span class="n">lli</span>

		<span class="n">lognu</span><span class="o">=</span><span class="n">seds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lognui</span>		
		<span class="n">m</span><span class="o">=</span><span class="n">sums</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">seds</span><span class="p">)</span>	<span class="c1"># takes the average</span>
		
		<span class="c1"># Computes the standard deviation</span>
		<span class="n">sd</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">sums</span><span class="p">)</span>	<span class="c1"># initializes the std. dev. array</span>
		<span class="k">for</span> <span class="n">sed</span> <span class="ow">in</span> <span class="n">seds</span><span class="p">:</span>
			<span class="n">sd</span><span class="o">=</span><span class="n">sd</span><span class="o">+</span><span class="p">(</span><span class="n">sed</span><span class="o">.</span><span class="n">lli</span><span class="o">-</span><span class="n">m</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
		<span class="n">sd</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">sd</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">seds</span><span class="p">))</span>
		
		<span class="n">meansed</span><span class="o">=</span><span class="n">SED</span><span class="p">(</span><span class="n">lognu</span><span class="o">=</span><span class="n">lognu</span><span class="p">,</span> <span class="n">ll</span><span class="o">=</span><span class="n">m</span><span class="p">,</span> <span class="n">logfmt</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
		<span class="n">sdsed</span><span class="o">=</span><span class="n">SED</span><span class="p">(</span><span class="n">lognu</span><span class="o">=</span><span class="n">lognu</span><span class="p">,</span> <span class="n">ll</span><span class="o">=</span><span class="n">sd</span><span class="p">,</span> <span class="n">logfmt</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
		
		<span class="k">return</span> <span class="p">[</span><span class="n">meansed</span><span class="p">,</span><span class="n">sdsed</span><span class="p">]</span></div>
		<span class="c1">#return SED(lognu=lognu, ll=m)</span>





<div class="viewcode-block" id="SED.median"><a class="viewcode-back" href="../../nmmn.html#nmmn.sed.SED.median">[docs]</a>	<span class="k">def</span> <span class="nf">median</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seds</span><span class="p">,</span> <span class="n">nuref</span><span class="o">=</span><span class="mf">17.684</span><span class="p">,</span> <span class="n">refnlnu</span><span class="o">=</span><span class="mf">1e40</span><span class="p">,</span> <span class="n">xray</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Given a list of SEDs and a reference value of log10(nu), normalizes the </span>
<span class="sd">	SEDs (s.normalize) at the given nuref and refnlnu, calculates the average </span>
<span class="sd">	of their luminosities (average(log10(nuLnu)), like Eracleous et al. 2010 does) </span>
<span class="sd">	and returns the list [mean,sd] where &#39;mean&#39; is SED object with the median and </span>
<span class="sd">	&#39;sd&#39; is the object with the	standard deviation.</span>
<span class="sd">	</span>
<span class="sd">	Alternatively, if the user provides the argument xray=True, then</span>
<span class="sd">	the method normalizes the SEDs such that they have the same X-ray</span>
<span class="sd">	luminosity refnlnu in the range 2-10 keV (thus ignoring the arg.</span>
<span class="sd">	nuref).</span>
<span class="sd">	</span>
<span class="sd">	&gt;&gt;&gt; means=s.median([s1,s2],17.684,1e40)</span>

<span class="sd">	returns median &lt;- [lognu, &lt;s1,s2&gt;],</span>
<span class="sd">	where &lt;s,s1,s2&gt; -&gt; &lt;log10[nuLnu(s),nuLnu(s1),nuLnu(s2)]&gt;, lognu being the common </span>
<span class="sd">	units of frequency for the SEDs after interpolation.</span>
<span class="sd">	</span>
<span class="sd">	&gt;&gt;&gt; means=s.median([s1,s2],refnlnu=1e40,xray=True)</span>

<span class="sd">	returns the mean after normalizing the SEDs to the X-ray lum.</span>
<span class="sd">	1e40 erg/s in the range 2-10 keV.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">normalize</span><span class="p">(</span><span class="n">seds</span><span class="p">,</span><span class="n">nuref</span><span class="p">,</span><span class="n">refnlnu</span><span class="p">,</span><span class="n">xray</span><span class="p">)</span>	<span class="c1"># normalize them to a common nu</span>
		
		<span class="c1"># Array that stores the median of luminosities</span>
		<span class="n">m</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">seds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lli</span><span class="p">)</span>
		
		<span class="c1"># Loop that uses the numpy.median method</span>
		<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">size</span><span class="p">):</span>
			<span class="n">x</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">seds</span><span class="p">))</span>
			<span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">seds</span><span class="p">)):</span>
				<span class="n">x</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">=</span><span class="n">seds</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">lli</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
			<span class="n">m</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

		<span class="n">lognu</span><span class="o">=</span><span class="n">seds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lognui</span>

		<span class="c1"># Computes the standard deviation</span>
		<span class="n">sd</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>	<span class="c1"># initializes the std. dev. array</span>
		<span class="k">for</span> <span class="n">sed</span> <span class="ow">in</span> <span class="n">seds</span><span class="p">:</span>
			<span class="n">sd</span><span class="o">=</span><span class="n">sd</span><span class="o">+</span><span class="p">(</span><span class="n">sed</span><span class="o">.</span><span class="n">lli</span><span class="o">-</span><span class="n">m</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
		<span class="n">sd</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">sd</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">seds</span><span class="p">))</span>
		
		<span class="n">meansed</span><span class="o">=</span><span class="n">SED</span><span class="p">(</span><span class="n">lognu</span><span class="o">=</span><span class="n">lognu</span><span class="p">,</span> <span class="n">ll</span><span class="o">=</span><span class="n">m</span><span class="p">,</span> <span class="n">logfmt</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
		<span class="n">sdsed</span><span class="o">=</span><span class="n">SED</span><span class="p">(</span><span class="n">lognu</span><span class="o">=</span><span class="n">lognu</span><span class="p">,</span> <span class="n">ll</span><span class="o">=</span><span class="n">sd</span><span class="p">,</span> <span class="n">logfmt</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
		
		<span class="k">return</span> <span class="p">[</span><span class="n">meansed</span><span class="p">,</span><span class="n">sdsed</span><span class="p">]</span></div>






	




<div class="viewcode-block" id="SED.geomean"><a class="viewcode-back" href="../../nmmn.html#nmmn.sed.SED.geomean">[docs]</a>	<span class="k">def</span> <span class="nf">geomean</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seds</span><span class="p">,</span> <span class="n">nuref</span><span class="o">=</span><span class="mf">17.684</span><span class="p">,</span> <span class="n">refnlnu</span><span class="o">=</span><span class="mf">1e40</span><span class="p">,</span> <span class="n">xray</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Given a list of SEDs and a reference value of log10(nu), normalizes the </span>
<span class="sd">	SEDs (s.normalize) at the given nuref and refnlnu, calculates the geometric</span>
<span class="sd">	mean of their luminosities (average(log10(nuLnu)), like Eracleous et al. 2010 does) </span>
<span class="sd">	and returns the list [mean,sd] where &#39;mean&#39; is SED object with the geometric </span>
<span class="sd">	mean and &#39;sd&#39; is the object with the standard deviation.</span>
<span class="sd">	</span>
<span class="sd">	Alternatively, if the user provides the argument xray=True, then</span>
<span class="sd">	the method normalizes the SEDs such that they have the same X-ray</span>
<span class="sd">	luminosity refnlnu in the range 2-10 keV (thus ignoring the arg.</span>
<span class="sd">	nuref).</span>
<span class="sd">	</span>
<span class="sd">	&gt;&gt;&gt; means=s.mean([s1,s2],17.684,1e40)</span>

<span class="sd">	returns mean &lt;- [lognu, &lt;s1,s2&gt;],</span>
<span class="sd">	where &lt;s,s1,s2&gt; -&gt; &lt;log10[nuLnu(s),nuLnu(s1),nuLnu(s2)]&gt;, lognu being the common </span>
<span class="sd">	units of frequency for the SEDs after interpolation.</span>
<span class="sd">	</span>
<span class="sd">	&gt;&gt;&gt; means=s.mean([s1,s2],refnlnu=1e40,xray=True)</span>
<span class="sd">	</span>
<span class="sd">	returns the mean after normalizing the SEDs to the X-ray lum.</span>
<span class="sd">	1e40 erg/s in the range 2-10 keV.</span>
<span class="sd">		&quot;&quot;&quot;</span>	
		<span class="bp">self</span><span class="o">.</span><span class="n">normalize</span><span class="p">(</span><span class="n">seds</span><span class="p">,</span><span class="n">nuref</span><span class="p">,</span><span class="n">refnlnu</span><span class="p">,</span><span class="n">xray</span><span class="p">)</span>	<span class="c1"># normalize them to a common nu</span>
		
		<span class="c1"># Calculates the product of log(nuLnu) (produtorio)</span>
		<span class="n">sums</span><span class="o">=</span><span class="n">seds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lli</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>	<span class="c1"># initializes the sum</span>
		<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">seds</span><span class="p">)):</span>
			<span class="n">sums</span><span class="o">=</span><span class="n">sums</span><span class="o">*</span><span class="n">seds</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">lli</span>

		<span class="n">lognu</span><span class="o">=</span><span class="n">seds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lognui</span>		
		<span class="n">m</span><span class="o">=</span><span class="n">sums</span><span class="o">**</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">seds</span><span class="p">))</span> 	<span class="c1"># takes the nth root</span>
		
		<span class="c1"># Computes the standard deviation</span>
		<span class="n">sd</span><span class="o">=</span><span class="n">sums</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>	<span class="c1"># initializes the std. dev. array</span>
		<span class="k">for</span> <span class="n">sed</span> <span class="ow">in</span> <span class="n">seds</span><span class="p">:</span>
			<span class="n">sd</span><span class="o">=</span><span class="n">sd</span><span class="o">+</span><span class="p">(</span><span class="n">sed</span><span class="o">.</span><span class="n">lli</span><span class="o">-</span><span class="n">m</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
		<span class="n">sd</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">sd</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">seds</span><span class="p">))</span>
		
		<span class="n">meansed</span><span class="o">=</span><span class="n">SED</span><span class="p">(</span><span class="n">lognu</span><span class="o">=</span><span class="n">lognu</span><span class="p">,</span> <span class="n">ll</span><span class="o">=</span><span class="n">m</span><span class="p">,</span> <span class="n">logfmt</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
		<span class="n">sdsed</span><span class="o">=</span><span class="n">SED</span><span class="p">(</span><span class="n">lognu</span><span class="o">=</span><span class="n">lognu</span><span class="p">,</span> <span class="n">ll</span><span class="o">=</span><span class="n">sd</span><span class="p">,</span> <span class="n">logfmt</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
		
		<span class="k">return</span> <span class="p">[</span><span class="n">meansed</span><span class="p">,</span><span class="n">sdsed</span><span class="p">]</span></div>







	
	
	
<div class="viewcode-block" id="SED.bol"><a class="viewcode-back" href="../../nmmn.html#nmmn.sed.SED.bol">[docs]</a>	<span class="k">def</span> <span class="nf">bol</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lognu0</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">lognu1</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xrange</span><span class="o">=</span><span class="p">[</span><span class="mi">8</span><span class="p">,</span><span class="mi">22</span><span class="p">]):</span>
<span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Calculates the bolometric luminosity of the SED. Performs the integration </span>
<span class="sd">	using the trapezoidal rule. Adds the attribute lumbol to the object with</span>
<span class="sd">	the result.</span>
<span class="sd">	</span>
<span class="sd">	&gt;&gt;&gt; s.bol()</span>

<span class="sd">	makes the variable s.lumbol hold the bolometric luminosity.</span>
<span class="sd">	</span>
<span class="sd">	&gt;&gt;&gt; s.bol(17, 20)</span>

<span class="sd">	makes s.lumbol hold the luminosity integrated in the range 1e17-1e20 Hz.</span>

<span class="sd">	&gt;&gt;&gt; s.bol(18, 20, [s.lognu[0],s.lognu[-1]])</span>

<span class="sd">	gives the integrated luminosity in the range 1e18-1e20 Hz. Before integrating,</span>
<span class="sd">	interpolates the SED over its original frequency range with 1000 points.</span>

<span class="sd">		&quot;&quot;&quot;</span>
		<span class="kn">import</span> <span class="nn">scipy.integrate</span>

		<span class="c1"># Performs interpolation before integrating. This is a precaution in </span>
		<span class="c1"># case the user specifies weird integration limits.	In addition, I </span>
		<span class="c1"># found out that integrating certain sparse SEDs (e.g. qsos) without</span>
		<span class="c1"># interpolating induces incorrect Lbol estimates		</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;nlnui&#39;</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">xrange</span><span class="o">=</span><span class="n">xrange</span><span class="p">)</span>			
		
		<span class="c1"># If no arguments are given to the method, integrates the entire SED</span>
		<span class="k">if</span> <span class="n">lognu0</span><span class="o">==</span><span class="kc">None</span> <span class="ow">and</span> <span class="n">lognu1</span><span class="o">==</span><span class="kc">None</span><span class="p">:</span>
			<span class="n">lumbol</span><span class="o">=</span><span class="n">scipy</span><span class="o">.</span><span class="n">integrate</span><span class="o">.</span><span class="n">trapz</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nlnui</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">nui</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nui</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="c1"># Gets only the elements in the given range</span>
			<span class="n">i</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">lognui</span><span class="o">&gt;=</span><span class="n">lognu0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lognui</span><span class="o">&lt;=</span><span class="n">lognu1</span><span class="p">))</span>
			
			<span class="c1"># Integration</span>
			<span class="n">lumbol</span><span class="o">=</span><span class="n">scipy</span><span class="o">.</span><span class="n">integrate</span><span class="o">.</span><span class="n">trapz</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nlnui</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">nui</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">nui</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

		<span class="bp">self</span><span class="o">.</span><span class="n">lumbol</span><span class="o">=</span><span class="n">lumbol</span>

		<span class="k">return</span> <span class="n">lumbol</span></div>





<div class="viewcode-block" id="SED.edd"><a class="viewcode-back" href="../../nmmn.html#nmmn.sed.SED.edd">[docs]</a>	<span class="k">def</span> <span class="nf">edd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">mass</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Computes the Eddington ratio :math:`L_{\\rm bol}/L_{\\rm} Edd}`.</span>
<span class="sd">	First computes the bolometric luminosity via interpolation and </span>
<span class="sd">	then calculates the Eddington ratio.</span>

<span class="sd">	:param mass: log10(BH mass in solar masses)</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="c1"># Computes Lbol before anything else	</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;lumbol&#39;</span><span class="p">):</span> 			
			<span class="n">lumbol</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bol</span><span class="p">()</span>

		<span class="c1"># if no mass argument was given</span>
		<span class="k">if</span> <span class="n">mass</span><span class="o">==</span><span class="kc">None</span><span class="p">:</span> 
			<span class="n">mass</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mass</span>

		<span class="c1"># Eddington ratio</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">lumedd</span><span class="o">=</span><span class="mf">1.3e38</span><span class="o">*</span><span class="mi">10</span><span class="o">**</span><span class="n">mass</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">eddratio</span><span class="o">=</span><span class="n">lumbol</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">lumedd</span>

		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">eddratio</span></div>

	


<div class="viewcode-block" id="SED.xrays"><a class="viewcode-back" href="../../nmmn.html#nmmn.sed.SED.xrays">[docs]</a>	<span class="k">def</span> <span class="nf">xrays</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Calculates the photon index of the X-ray spectrum and Lx (2-10 keV). </span>
<span class="sd">	Stores the new attributes gammax and lumx in the object.</span>
<span class="sd">	</span>
<span class="sd">	&gt;&gt;&gt; Lx,gamma=s.xrays()</span>

<span class="sd">	creates the new attributes s.lumx and s.gammax</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="kn">import</span> <span class="nn">scipy.integrate</span>
		<span class="kn">import</span> <span class="nn">scipy.stats</span>
		
		<span class="c1"># Performs interpolation before integrating. This is a precaution in </span>
		<span class="c1"># case the user specify weird integration limits.			</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;nlnui&#39;</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">interp</span><span class="p">()</span>
		
		<span class="c1"># 2-10 keV in log(nu)</span>
		<span class="n">xi</span><span class="p">,</span> <span class="n">xf</span> <span class="o">=</span> <span class="mf">17.684</span><span class="p">,</span> <span class="mf">18.384</span>
		
		<span class="c1"># Gets only the elements in the range 2-10 keV</span>
		<span class="n">i</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">lognui</span><span class="o">&gt;=</span><span class="n">xi</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lognui</span><span class="o">&lt;=</span><span class="n">xf</span><span class="p">))</span>
		<span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lognui</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">lli</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>	<span class="c1"># easier notation</span>
		
		<span class="c1"># Calculates Lx using integration (trapezoidal rule)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">lumx</span><span class="o">=</span><span class="n">scipy</span><span class="o">.</span><span class="n">integrate</span><span class="o">.</span><span class="n">trapz</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nlnui</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">nui</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">nui</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

		<span class="c1"># Linear fit to the SED in the interval 2-10 keV, y=ax+b</span>
		<span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">linregress</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
		
		<span class="c1"># Calculates Gamma_X (photon index)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">gammax</span><span class="o">=</span><span class="mi">2</span><span class="o">-</span><span class="n">a</span>

		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">lumx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gammax</span></div>
		
		
		
		
		
	
<div class="viewcode-block" id="SED.findlum"><a class="viewcode-back" href="../../nmmn.html#nmmn.sed.SED.findlum">[docs]</a>	<span class="k">def</span> <span class="nf">findlum</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Given the input frequency in units of log(nu/Hz), returns the list [log(nu),</span>
<span class="sd">	Lnu] with the frequency and luminosity closest to the specified value.</span>
<span class="sd">	</span>
<span class="sd">	&gt;&gt;&gt; lognu,lum=s.findlum(14)</span>

<span class="sd">	will look for the freq. and lum. nearest nu=10^14 Hz</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="c1"># Performs interpolation before the search</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;nlnui&#39;</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">interp</span><span class="p">()</span>
		
		<span class="c1"># Looks for the frequency</span>
		<span class="n">i</span><span class="o">=</span><span class="n">lsd</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">lognui</span><span class="p">)</span>	<span class="c1"># index</span>
		
		<span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">lognui</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">nlnui</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">nui</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span></div>
	
	
	
	
	
	
<div class="viewcode-block" id="SED.radioloud"><a class="viewcode-back" href="../../nmmn.html#nmmn.sed.SED.radioloud">[docs]</a>	<span class="k">def</span> <span class="nf">radioloud</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Computes the radio-loudness for the SED. Adds the attribute rl to the </span>
<span class="sd">	object with	the result. If Ro&gt;=10. we have a RL AGN, otherwise it is a</span>
<span class="sd">	RQ one.</span>
<span class="sd">	</span>
<span class="sd">	&gt;&gt;&gt; rl=s.radioloud()</span>

<span class="sd">	makes the variable s.rl hold the radio-loudness.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="c1"># Radio luminosity at 6 cm. 6 cm -&gt; 4.997x10^9 Hz -&gt; lognu=9.7</span>
		<span class="n">lumrad</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">findlum</span><span class="p">(</span><span class="mf">9.7</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
		
		<span class="c1"># Optical lum. at 4400 A. B band -&gt; 4400 A -&gt; 6.813x10^14 Hz -&gt; lognu=14.833 </span>
		<span class="n">lumopt</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">findlum</span><span class="p">(</span><span class="mf">14.833</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
				
		<span class="c1"># Kellermann recipe: Lnu(6 cm)/Lnu(B)</span>
		<span class="k">return</span> <span class="n">lumrad</span><span class="o">/</span><span class="n">lumopt</span></div>





<div class="viewcode-block" id="SED.alphaox"><a class="viewcode-back" href="../../nmmn.html#nmmn.sed.SED.alphaox">[docs]</a>	<span class="k">def</span> <span class="nf">alphaox</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Computes the alpha_ox index.</span>

<span class="sd">	&gt;&gt;&gt; alphaox=s.alphaox()</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="c1"># Lnu(2 keV)</span>
		<span class="n">lumx</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">findlum</span><span class="p">(</span><span class="mf">17.684</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
		
		<span class="c1"># UV lum. at 2500 AA -&gt; 1.199e15 Hz  -&gt; lognu=15.079 </span>
		<span class="n">lumuv</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">findlum</span><span class="p">(</span><span class="mf">15.079</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
		
		<span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">lumx</span><span class="o">/</span><span class="n">lumuv</span><span class="p">)</span><span class="o">/</span><span class="mf">2.605</span></div>





<div class="viewcode-block" id="SED.ion"><a class="viewcode-back" href="../../nmmn.html#nmmn.sed.SED.ion">[docs]</a>	<span class="k">def</span> <span class="nf">ion</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Calculates the rate of ionizing photons in the SED.</span>
<span class="sd">	</span>
<span class="sd">	&gt;&gt;&gt; q=s.ion()</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="kn">import</span> <span class="nn">scipy.integrate</span>
		<span class="kn">import</span> <span class="nn">scipy.stats</span>
		<span class="n">h</span><span class="o">=</span><span class="mf">6.62607e-27</span>	<span class="c1"># Planck constant in CGS</span>
		
		<span class="c1"># Performs interpolation before integrating. This is a precaution in </span>
		<span class="c1"># case the user specify weird integration limits.			</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;nlnui&#39;</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">interp</span><span class="p">()</span>
		
		<span class="c1"># 13.6 eV - &quot;infty&quot;</span>
		<span class="n">xi</span><span class="p">,</span> <span class="n">xf</span> <span class="o">=</span> <span class="mf">15.52</span><span class="p">,</span> <span class="mf">22.</span>
		
		<span class="c1"># Gets only the elements corresponding to ionizing frequencies</span>
		<span class="n">i</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">lognui</span><span class="o">&gt;=</span><span class="n">xi</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lognui</span><span class="o">&lt;=</span><span class="n">xf</span><span class="p">))</span>
		<span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lognui</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">lli</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>	<span class="c1"># easier notation</span>
		
		<span class="c1"># Calculates ionizing rate using integration (trapezoidal rule)</span>
		<span class="n">q</span><span class="o">=</span><span class="n">scipy</span><span class="o">.</span><span class="n">integrate</span><span class="o">.</span><span class="n">trapz</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nlnui</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">nui</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">h</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">nui</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="bp">self</span><span class="o">.</span><span class="n">nui</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

		<span class="k">return</span> <span class="n">q</span></div>


		
		
	
	
	
<div class="viewcode-block" id="SED.chisq"><a class="viewcode-back" href="../../nmmn.html#nmmn.sed.SED.chisq">[docs]</a>	<span class="k">def</span> <span class="nf">chisq</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">npars</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Computes the goodness of fit between the observed SED (assumed to be &quot;self&quot;) </span>
<span class="sd">	and the given model. If you don&#39;t provide the number of free </span>
<span class="sd">	parameters in the model, it returns a modified chi squared (modified in </span>
<span class="sd">	the sense that it assumes the uncertainties in all data points to be unity).</span>
<span class="sd">	If you provide npars it returns the modified reduced chi squared.</span>
<span class="sd">	</span>
<span class="sd">	&gt;&gt;&gt; s.chisq(m)</span>
<span class="sd">	returns the (modified) chi square with s and m being the observed and model</span>
<span class="sd">	SEDs, respectively.</span>
<span class="sd">	</span>
<span class="sd">	&gt;&gt;&gt; s.chisq(m,4)</span>
<span class="sd">	returns the reduced chi square.</span>
<span class="sd">	</span>
<span class="sd">	NOTE: this method was written assuming that the observed SEDs correspond</span>
<span class="sd">	to Eracleous&#39; SEDs. Needs to be adapted in order to be applied to other </span>
<span class="sd">	types of SEDs. We discard the 100 keV interpolation done by EHF10.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">obs</span><span class="o">=</span><span class="bp">self</span>
		
		<span class="c1"># Discards upper limits in the data and the 100 keV interpolated point </span>
		<span class="n">i</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">obs</span><span class="o">.</span><span class="n">ul</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">obs</span><span class="o">.</span><span class="n">lognu</span><span class="o">&lt;</span><span class="mf">19.</span><span class="p">))</span>	<span class="c1"># index of elements corresponding to good elements</span>
		
		<span class="c1"># Interpolates the model SED in the same binning as the obs.</span>
		<span class="n">yobs</span><span class="o">=</span><span class="n">obs</span><span class="o">.</span><span class="n">ll</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
		<span class="n">ymod</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">obs</span><span class="o">.</span><span class="n">lognu</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">model</span><span class="o">.</span><span class="n">lognu</span><span class="p">,</span><span class="n">model</span><span class="o">.</span><span class="n">ll</span><span class="p">)</span>

		<span class="c1"># Chi-square </span>
		<span class="k">if</span> <span class="n">npars</span><span class="o">==</span><span class="kc">None</span><span class="p">:</span>
			<span class="n">chisq</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">yobs</span><span class="o">-</span><span class="n">ymod</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>	<span class="c1"># or reduced chi-square statistic</span>
			<span class="n">nu</span><span class="o">=</span><span class="n">yobs</span><span class="o">.</span><span class="n">size</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="n">npars</span>		<span class="c1"># Number of degrees of freedom</span>
			<span class="n">chisq</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">yobs</span><span class="o">-</span><span class="n">ymod</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="n">nu</span>
			
		<span class="k">return</span> <span class="n">chisq</span></div>
	
	
	
	
	
<div class="viewcode-block" id="SED.copy"><a class="viewcode-back" href="../../nmmn.html#nmmn.sed.SED.copy">[docs]</a>	<span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Returns a copy of the current SED object. Use this in the same way you would use</span>
<span class="sd">	the numpy copy() method to avoid changing the attributes of a SED</span>
<span class="sd">	unintentionally.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">c</span><span class="o">=</span><span class="n">SED</span><span class="p">(</span><span class="n">lognu</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lognu</span><span class="p">,</span><span class="n">ll</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ll</span><span class="p">,</span><span class="n">file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="p">)</span>
		
		<span class="c1"># Precaution if SED was imported using erac method</span>
		<span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;llex&#39;</span><span class="p">):</span>
			<span class="n">c</span><span class="o">.</span><span class="n">llex</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">llex</span>
			<span class="n">c</span><span class="o">.</span><span class="n">nlnuex</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nlnuex</span>
			<span class="n">c</span><span class="o">.</span><span class="n">ul</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ul</span>
		
		<span class="k">return</span> <span class="n">c</span></div></div>




<div class="viewcode-block" id="sum"><a class="viewcode-back" href="../../nmmn.html#nmmn.sed.sum">[docs]</a><span class="k">def</span> <span class="nf">sum</span><span class="p">(</span><span class="n">seds</span><span class="p">):</span>
<span class="w">	</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Given a list of SEDs previously interpolated in the same binning, </span>
<span class="sd">sums their luminosities and returns a SED object with the sum.</span>
<span class="sd">	</span>
<span class="sd">&gt;&gt;&gt; ss=sum([s,s1,s2])</span>

<span class="sd">returns the SED ss &lt;- [lognu, s+s1+s2],</span>
<span class="sd">where s+s1+s2 -&gt; log10[nuLnu(s)+nuLnu(s1)+nuLnu(s2)], lognu being the common </span>
<span class="sd">units of frequency for the SEDs after interpolation.</span>
<span class="sd">	</span>
<span class="sd">The method is designed to automatically call the interp method for each SED</span>
<span class="sd">if needed.</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="c1"># Precaution in case the user did not use the interp method</span>
	<span class="n">seds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">seds</span><span class="p">)</span>
		
	<span class="n">sums</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">seds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lognui</span><span class="p">)</span>	<span class="c1"># initializes the sum</span>

	<span class="k">for</span> <span class="n">sed</span> <span class="ow">in</span> <span class="n">seds</span><span class="p">:</span>
		<span class="n">sums</span><span class="o">=</span><span class="n">sums</span><span class="o">+</span><span class="n">sed</span><span class="o">.</span><span class="n">nlnui</span>
		
	<span class="k">return</span> <span class="n">SED</span><span class="p">(</span><span class="n">lognu</span><span class="o">=</span><span class="n">seds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lognui</span><span class="p">,</span> <span class="n">ll</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">sums</span><span class="p">),</span> <span class="n">logfmt</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></div>

		







<div class="viewcode-block" id="haydensed"><a class="viewcode-back" href="../../nmmn.html#nmmn.sed.haydensed">[docs]</a><span class="k">def</span> <span class="nf">haydensed</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">patho</span><span class="o">=</span><span class="s1">&#39;/Users/nemmen/work/projects/hayden/all/&#39;</span><span class="p">,</span> <span class="n">info</span><span class="o">=</span><span class="s1">&#39;/Users/nemmen/work/projects/hayden/info.dat&#39;</span><span class="p">):</span>
<span class="w">	</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Reads an observed SED from the Hayden et al. sample. Computes useful </span>
<span class="sd">quantities.</span>

<span class="sd">:param source: source name e.g. &#39;NGC1097&#39; or &#39;ngc1097&#39; or &#39;NGC 1097&#39;. Must have four numbers.</span>
<span class="sd">:param patho: path to observed SED data files</span>
<span class="sd">:param info: path to information datafile with distances and masses</span>

<span class="sd">:returns: SED object </span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="c1"># READS SEDS</span>
	<span class="c1"># =============</span>
	<span class="c1"># Finds the required parameters to plot the data for the specified source.</span>
	<span class="c1"># First converts the source name to uppercase, no spaces</span>
	<span class="n">source</span><span class="o">=</span><span class="n">source</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
	<span class="n">source</span><span class="o">=</span><span class="n">source</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>

	<span class="c1"># Reads information table and gets required info</span>
	<span class="n">t</span><span class="o">=</span><span class="n">ascii</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">info</span><span class="p">)</span>
	<span class="n">names</span><span class="o">=</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
	<span class="c1"># finds location of source in the arrays</span>
	<span class="n">i</span><span class="o">=</span><span class="n">names</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
	<span class="c1"># gets distance </span>
	<span class="n">dist</span><span class="o">=</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;distance/Mpc&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
	<span class="c1"># gets BH mass</span>
	<span class="n">mass</span><span class="o">=</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;logmass&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>

	<span class="c1"># Reads observed SED from radio to X-rays </span>
	<span class="c1"># (which is given in weird units)</span>
	<span class="n">ofile</span><span class="o">=</span><span class="n">patho</span><span class="o">+</span><span class="n">source</span><span class="o">+</span><span class="s1">&#39;_sed.txt&#39;</span>
	<span class="n">o</span><span class="o">=</span><span class="n">SED</span><span class="p">()</span>
	<span class="n">o</span><span class="o">.</span><span class="n">hayden</span><span class="p">(</span><span class="n">ofile</span><span class="p">,</span><span class="n">dist</span><span class="p">)</span>
	<span class="n">o</span><span class="o">.</span><span class="n">mass</span><span class="o">=</span><span class="n">mass</span>	
		
	<span class="c1"># X-ray data</span>
	<span class="c1"># Reads Panessa&#39;s X-ray SED and creates another SED object</span>
	<span class="n">xfile</span><span class="o">=</span><span class="n">patho</span><span class="o">+</span><span class="n">source</span><span class="o">+</span><span class="s1">&#39;_x.txt&#39;</span>
	<span class="n">x</span><span class="o">=</span><span class="n">SED</span><span class="p">()</span>
	<span class="n">x</span><span class="o">.</span><span class="n">haydenx</span><span class="p">(</span><span class="n">xfile</span><span class="p">)</span>	

	<span class="c1"># Stacks together all the multiwavelength information</span>
	<span class="n">o</span><span class="o">.</span><span class="n">lognu</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">o</span><span class="o">.</span><span class="n">lognu</span><span class="p">,</span><span class="n">x</span><span class="o">.</span><span class="n">lognu</span><span class="p">])</span>
	<span class="n">o</span><span class="o">.</span><span class="n">ll</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">o</span><span class="o">.</span><span class="n">ll</span><span class="p">,</span><span class="n">x</span><span class="o">.</span><span class="n">ll</span><span class="p">])</span>	

	<span class="k">return</span> <span class="n">o</span></div>









<div class="viewcode-block" id="modelsplot"><a class="viewcode-back" href="../../nmmn.html#nmmn.sed.modelsplot">[docs]</a><span class="k">def</span> <span class="nf">modelsplot</span><span class="p">(</span><span class="n">pathm</span><span class="o">=</span><span class="s1">&#39;/Users/nemmen/Dropbox/work/projects/adafjet/&#39;</span><span class="p">,</span>
	<span class="n">jetfile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">showthin</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">showjet</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">showsum</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">showadaf</span><span class="o">=</span><span class="p">[</span><span class="kc">True</span><span class="p">,</span><span class="kc">True</span><span class="p">,</span><span class="kc">True</span><span class="p">]):</span>
<span class="w">	</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Nice wrapper that plots 3 models computed with the ADAF Fortran code available at</span>
<span class="sd">~/work/projects/adafjet/adaf.</span>

<span class="sd">Useful when modeling a given SED.</span>

<span class="sd">Input:</span>
<span class="sd">  - *file : path to ASCII files containing the precomputed models</span>
<span class="sd">  - showadaf : should I display the three ADAF models? (list or array of booleans, </span>
<span class="sd">  	e.g., [True,True,True])</span>
<span class="sd">  - showthin : Include thin disk?</span>
<span class="sd">  - showjet : Display jet?</span>
<span class="sd">  - showsum : Show sum of components?</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="k">if</span> <span class="n">showjet</span><span class="o">==</span><span class="kc">True</span><span class="p">:</span>
		<span class="k">if</span> <span class="n">jetfile</span><span class="o">==</span><span class="kc">None</span><span class="p">:</span>
			<span class="n">jet</span><span class="o">=</span><span class="n">SED</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="n">pathm</span><span class="o">+</span><span class="s1">&#39;jet/jet.dat&#39;</span><span class="p">,</span><span class="n">logfmt</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">jet</span><span class="o">=</span><span class="n">SED</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="n">jetfile</span><span class="p">,</span><span class="n">logfmt</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>	
		<span class="n">pylab</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">jet</span><span class="o">.</span><span class="n">lognu</span><span class="p">,</span><span class="n">jet</span><span class="o">.</span><span class="n">ll</span><span class="p">,</span><span class="s1">&#39;-.m&#39;</span><span class="p">)</span>

	<span class="k">if</span> <span class="n">showadaf</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="kc">True</span><span class="p">:</span>
		<span class="n">adaf</span><span class="o">=</span><span class="n">SED</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="n">pathm</span><span class="o">+</span><span class="s1">&#39;adaf/perl/run01/spec_01&#39;</span><span class="p">,</span><span class="n">logfmt</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
		<span class="n">pylab</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">adaf</span><span class="o">.</span><span class="n">lognu</span><span class="p">,</span><span class="n">adaf</span><span class="o">.</span><span class="n">ll</span><span class="p">,</span><span class="s1">&#39;--b&#39;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">showthin</span><span class="o">==</span><span class="kc">True</span><span class="p">:</span>
			<span class="n">thin</span><span class="o">=</span><span class="n">SED</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="n">pathm</span><span class="o">+</span><span class="s1">&#39;adaf/perl/run01/spec_01_ssd&#39;</span><span class="p">,</span><span class="n">logfmt</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> 
			<span class="c1">#thin=SED(file=thinfile,logfmt=1) </span>
			<span class="n">pylab</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">thin</span><span class="o">.</span><span class="n">lognu</span><span class="p">,</span><span class="n">thin</span><span class="o">.</span><span class="n">ll</span><span class="p">,</span><span class="s1">&#39;:r&#39;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">showjet</span> <span class="ow">and</span> <span class="n">showthin</span><span class="p">:</span> <span class="nb">sum</span><span class="o">=</span><span class="nb">sum</span><span class="p">([</span><span class="n">adaf</span><span class="p">,</span><span class="n">jet</span><span class="p">,</span><span class="n">thin</span><span class="p">])</span>
		<span class="k">if</span> <span class="n">showjet</span><span class="o">==</span><span class="kc">True</span> <span class="ow">and</span> <span class="n">showthin</span><span class="o">==</span><span class="kc">False</span><span class="p">:</span> <span class="nb">sum</span><span class="o">=</span><span class="nb">sum</span><span class="p">([</span><span class="n">adaf</span><span class="p">,</span><span class="n">jet</span><span class="p">])</span>
		<span class="k">if</span> <span class="n">showjet</span><span class="o">==</span><span class="kc">False</span> <span class="ow">and</span> <span class="n">showthin</span><span class="o">==</span><span class="kc">True</span><span class="p">:</span> <span class="nb">sum</span><span class="o">=</span><span class="nb">sum</span><span class="p">([</span><span class="n">adaf</span><span class="p">,</span><span class="n">thin</span><span class="p">])</span>
		<span class="k">if</span> <span class="n">showsum</span><span class="o">==</span><span class="kc">True</span><span class="p">:</span> <span class="n">pylab</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">sum</span><span class="o">.</span><span class="n">lognu</span><span class="p">,</span><span class="nb">sum</span><span class="o">.</span><span class="n">ll</span><span class="p">,</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>

	<span class="k">if</span> <span class="n">showadaf</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="kc">True</span><span class="p">:</span>
		<span class="n">adaf</span><span class="o">=</span><span class="n">SED</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="n">pathm</span><span class="o">+</span><span class="s1">&#39;adaf/perl/run02/spec_02&#39;</span><span class="p">,</span><span class="n">logfmt</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
		<span class="n">pylab</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">adaf</span><span class="o">.</span><span class="n">lognu</span><span class="p">,</span><span class="n">adaf</span><span class="o">.</span><span class="n">ll</span><span class="p">,</span><span class="s1">&#39;--b&#39;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">showthin</span><span class="o">==</span><span class="kc">True</span><span class="p">:</span>
			<span class="n">thin</span><span class="o">=</span><span class="n">SED</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="n">pathm</span><span class="o">+</span><span class="s1">&#39;adaf/perl/run02/spec_02_ssd&#39;</span><span class="p">,</span><span class="n">logfmt</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> 
			<span class="c1">#thin=SED(file=thinfile,logfmt=1) </span>
			<span class="n">pylab</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">thin</span><span class="o">.</span><span class="n">lognu</span><span class="p">,</span><span class="n">thin</span><span class="o">.</span><span class="n">ll</span><span class="p">,</span><span class="s1">&#39;:r&#39;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">showjet</span> <span class="ow">and</span> <span class="n">showthin</span><span class="p">:</span> <span class="nb">sum</span><span class="o">=</span><span class="nb">sum</span><span class="p">([</span><span class="n">adaf</span><span class="p">,</span><span class="n">jet</span><span class="p">,</span><span class="n">thin</span><span class="p">])</span>
		<span class="k">if</span> <span class="n">showjet</span><span class="o">==</span><span class="kc">True</span> <span class="ow">and</span> <span class="n">showthin</span><span class="o">==</span><span class="kc">False</span><span class="p">:</span> <span class="nb">sum</span><span class="o">=</span><span class="nb">sum</span><span class="p">([</span><span class="n">adaf</span><span class="p">,</span><span class="n">jet</span><span class="p">])</span>
		<span class="k">if</span> <span class="n">showjet</span><span class="o">==</span><span class="kc">False</span> <span class="ow">and</span> <span class="n">showthin</span><span class="o">==</span><span class="kc">True</span><span class="p">:</span> <span class="nb">sum</span><span class="o">=</span><span class="nb">sum</span><span class="p">([</span><span class="n">adaf</span><span class="p">,</span><span class="n">thin</span><span class="p">])</span>
		<span class="k">if</span> <span class="n">showsum</span><span class="o">==</span><span class="kc">True</span><span class="p">:</span> <span class="n">pylab</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">sum</span><span class="o">.</span><span class="n">lognu</span><span class="p">,</span><span class="nb">sum</span><span class="o">.</span><span class="n">ll</span><span class="p">,</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>

	<span class="k">if</span> <span class="n">showadaf</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">==</span><span class="kc">True</span><span class="p">:</span>
		<span class="n">adaf</span><span class="o">=</span><span class="n">SED</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="n">pathm</span><span class="o">+</span><span class="s1">&#39;adaf/perl/run03/spec_03&#39;</span><span class="p">,</span><span class="n">logfmt</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
		<span class="n">pylab</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">adaf</span><span class="o">.</span><span class="n">lognu</span><span class="p">,</span><span class="n">adaf</span><span class="o">.</span><span class="n">ll</span><span class="p">,</span><span class="s1">&#39;--b&#39;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">showthin</span><span class="o">==</span><span class="kc">True</span><span class="p">:</span>
			<span class="n">thin</span><span class="o">=</span><span class="n">SED</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="n">pathm</span><span class="o">+</span><span class="s1">&#39;adaf/perl/run03/spec_03_ssd&#39;</span><span class="p">,</span><span class="n">logfmt</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> 
			<span class="c1">#thin=SED(file=thinfile,logfmt=1) 	</span>
			<span class="n">pylab</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">thin</span><span class="o">.</span><span class="n">lognu</span><span class="p">,</span><span class="n">thin</span><span class="o">.</span><span class="n">ll</span><span class="p">,</span><span class="s1">&#39;:r&#39;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">showjet</span> <span class="ow">and</span> <span class="n">showthin</span><span class="p">:</span> <span class="nb">sum</span><span class="o">=</span><span class="nb">sum</span><span class="p">([</span><span class="n">adaf</span><span class="p">,</span><span class="n">jet</span><span class="p">,</span><span class="n">thin</span><span class="p">])</span>
		<span class="k">if</span> <span class="n">showjet</span><span class="o">==</span><span class="kc">True</span> <span class="ow">and</span> <span class="n">showthin</span><span class="o">==</span><span class="kc">False</span><span class="p">:</span> <span class="nb">sum</span><span class="o">=</span><span class="nb">sum</span><span class="p">([</span><span class="n">adaf</span><span class="p">,</span><span class="n">jet</span><span class="p">])</span>
		<span class="k">if</span> <span class="n">showjet</span><span class="o">==</span><span class="kc">False</span> <span class="ow">and</span> <span class="n">showthin</span><span class="o">==</span><span class="kc">True</span><span class="p">:</span> <span class="nb">sum</span><span class="o">=</span><span class="nb">sum</span><span class="p">([</span><span class="n">adaf</span><span class="p">,</span><span class="n">thin</span><span class="p">])</span>
		<span class="k">if</span> <span class="n">showsum</span><span class="o">==</span><span class="kc">True</span><span class="p">:</span> <span class="n">pylab</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">sum</span><span class="o">.</span><span class="n">lognu</span><span class="p">,</span><span class="nb">sum</span><span class="o">.</span><span class="n">ll</span><span class="p">,</span><span class="s1">&#39;k&#39;</span><span class="p">)</span></div>





<div class="viewcode-block" id="modelplot"><a class="viewcode-back" href="../../nmmn.html#nmmn.sed.modelplot">[docs]</a><span class="k">def</span> <span class="nf">modelplot</span><span class="p">(</span><span class="n">ssdf</span><span class="p">,</span><span class="n">adaff</span><span class="p">,</span><span class="n">jetf</span><span class="p">,</span><span class="n">sumf</span><span class="p">,</span><span class="o">**</span><span class="n">args</span><span class="p">):</span>
<span class="w">	</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Plots the model components.</span>

<span class="sd">Arguments: The filenames of each model component.</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="c1"># Reads model SEDs, checking first if the data files exist</span>
	<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">sumf</span><span class="p">):</span> <span class="n">msum</span><span class="o">=</span><span class="n">SED</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="n">sumf</span><span class="p">,</span><span class="n">logfmt</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> 
	<span class="k">else</span><span class="p">:</span> <span class="n">msum</span><span class="o">=</span><span class="kc">None</span>
	<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">adaff</span><span class="p">):</span> <span class="n">adaf</span><span class="o">=</span><span class="n">SED</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="n">adaff</span><span class="p">,</span><span class="n">logfmt</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> 
	<span class="k">else</span><span class="p">:</span> <span class="n">adaf</span><span class="o">=</span><span class="kc">None</span>
	<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">jetf</span><span class="p">):</span> <span class="n">jet</span><span class="o">=</span><span class="n">SED</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="n">jetf</span><span class="p">,</span><span class="n">logfmt</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> 
	<span class="k">else</span><span class="p">:</span> <span class="n">jet</span><span class="o">=</span><span class="kc">None</span>
	<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">ssdf</span><span class="p">):</span> <span class="n">ssd</span><span class="o">=</span><span class="n">SED</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="n">ssdf</span><span class="p">,</span><span class="n">logfmt</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> 
	<span class="k">else</span><span class="p">:</span> <span class="n">ssd</span><span class="o">=</span><span class="kc">None</span>
	
	<span class="c1"># Groups the model components in a dictionary</span>
	<span class="n">m</span><span class="o">=</span><span class="n">groupmodel</span><span class="p">(</span><span class="nb">sum</span><span class="o">=</span><span class="n">msum</span><span class="p">,</span><span class="n">ssd</span><span class="o">=</span><span class="n">ssd</span><span class="p">,</span><span class="n">adaf</span><span class="o">=</span><span class="n">adaf</span><span class="p">,</span><span class="n">jet</span><span class="o">=</span><span class="n">jet</span><span class="p">)</span>

	<span class="k">if</span> <span class="s1">&#39;sum&#39;</span> <span class="ow">in</span> <span class="n">m</span><span class="p">:</span> <span class="n">pylab</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="s1">&#39;sum&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lognu</span><span class="p">,</span><span class="n">m</span><span class="p">[</span><span class="s1">&#39;sum&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">ll</span><span class="p">,</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="o">**</span><span class="n">args</span><span class="p">)</span>
	<span class="k">if</span> <span class="s1">&#39;adaf&#39;</span> <span class="ow">in</span> <span class="n">m</span><span class="p">:</span> <span class="n">pylab</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="s1">&#39;adaf&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lognu</span><span class="p">,</span><span class="n">m</span><span class="p">[</span><span class="s1">&#39;adaf&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">ll</span><span class="p">,</span><span class="s1">&#39;--&#39;</span><span class="p">,</span><span class="o">**</span><span class="n">args</span><span class="p">)</span>
	<span class="k">if</span> <span class="s1">&#39;jet&#39;</span> <span class="ow">in</span> <span class="n">m</span><span class="p">:</span> <span class="n">pylab</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="s1">&#39;jet&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lognu</span><span class="p">,</span><span class="n">m</span><span class="p">[</span><span class="s1">&#39;jet&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">ll</span><span class="p">,</span><span class="s1">&#39;-.&#39;</span><span class="p">,</span><span class="o">**</span><span class="n">args</span><span class="p">)</span>
	<span class="c1">#if &#39;ssd&#39; in m: pylab.plot(m[&#39;ssd&#39;].lognu,m[&#39;ssd&#39;].ll,&#39;:&#39;,**args)</span>
	<span class="k">if</span> <span class="s1">&#39;ssd&#39;</span> <span class="ow">in</span> <span class="n">m</span><span class="p">:</span> <span class="n">pylab</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="s1">&#39;ssd&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lognu</span><span class="p">,</span><span class="n">m</span><span class="p">[</span><span class="s1">&#39;ssd&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">ll</span><span class="p">,</span><span class="s1">&#39;:&#39;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="o">**</span><span class="n">args</span><span class="p">)</span></div>













<div class="viewcode-block" id="obsplot"><a class="viewcode-back" href="../../nmmn.html#nmmn.sed.obsplot">[docs]</a><span class="k">def</span> <span class="nf">obsplot</span><span class="p">(</span><span class="n">source</span><span class="p">,</span>
	  <span class="n">table</span><span class="o">=</span><span class="s1">&#39;/Users/nemmen/Dropbox/work/projects/finished/liners/tables/models.csv&#39;</span><span class="p">,</span>
	  <span class="n">patho</span><span class="o">=</span><span class="s1">&#39;/Users/nemmen/Dropbox/work/projects/finished/liners/seds/obsdata/&#39;</span><span class="p">,</span>
	  <span class="n">ext</span><span class="o">=</span><span class="s1">&#39;0&#39;</span>
	  <span class="p">):</span>
<span class="w">	</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Plots the observed SED taken from the Eracleous et al. sample. Includes arrows </span>
<span class="sd">for upper limits and the nice bow tie. </span>

<span class="sd">Extinction corrections represented as either &quot;error bars&quot; or &quot;circle + error bar&quot;.</span>

<span class="sd">:param source: source name e.g. &#39;NGC1097&#39; or &#39;ngc1097&#39; or &#39;NGC 1097&#39;. Must have four numbers.</span>
<span class="sd">:param table: path of ASCII table models.csv with the required SED parameters gammax, error in gammax, X-ray luminosity and distratio</span>
<span class="sd">:param patho: path to observed SED data files</span>
<span class="sd">:param ext: 0 for showing extinction corrections as &quot;error bars&quot;; 1 for &quot;circle + error bar&quot;</span>
<span class="sd">:returns: SED object with distance-corrected luminosities</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="c1"># Reads the ASCII table models.csv</span>
	<span class="n">t</span><span class="o">=</span><span class="n">ascii</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">table</span><span class="p">,</span><span class="n">Reader</span><span class="o">=</span><span class="n">ascii</span><span class="o">.</span><span class="n">CommentedHeader</span><span class="p">,</span><span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)</span>
	<span class="n">tname</span><span class="p">,</span><span class="n">tmodel</span><span class="p">,</span><span class="n">tdistratio</span><span class="p">,</span><span class="n">tgammax</span><span class="p">,</span><span class="n">tegammal</span><span class="p">,</span><span class="n">tegammau</span><span class="p">,</span><span class="n">tlumx</span><span class="o">=</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;Object&#39;</span><span class="p">],</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;Model&#39;</span><span class="p">],</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;distratio&#39;</span><span class="p">],</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;gammax&#39;</span><span class="p">],</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;egammal&#39;</span><span class="p">],</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;egammau&#39;</span><span class="p">],</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;lumx&#39;</span><span class="p">]</span>

	<span class="c1"># Finds the required parameters to plot the data for the specified source.</span>
	<span class="c1"># First converts the source name to uppercase, no spaces</span>
	<span class="n">source</span><span class="o">=</span><span class="n">source</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
	<span class="n">source</span><span class="o">=</span><span class="n">source</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
	<span class="c1"># Finds the first occurrence of the source in the table</span>
	<span class="n">i</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">tname</span><span class="o">==</span><span class="n">source</span><span class="p">)</span>
	<span class="n">i</span><span class="o">=</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
	<span class="c1"># Retrieves the required parameters</span>
	<span class="n">distratio</span><span class="o">=</span><span class="n">tdistratio</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
	<span class="n">gammax</span><span class="o">=</span><span class="n">tgammax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
	<span class="n">egammal</span><span class="o">=</span><span class="n">tegammal</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
	<span class="n">egammau</span><span class="o">=</span><span class="n">tegammau</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
	<span class="n">lumx</span><span class="o">=</span><span class="n">tlumx</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

	<span class="c1"># Reads observed SED</span>
	<span class="n">ofile</span><span class="o">=</span><span class="n">patho</span><span class="o">+</span><span class="n">source</span><span class="o">+</span><span class="s1">&#39;.dat&#39;</span>
	<span class="n">o</span><span class="o">=</span><span class="n">SED</span><span class="p">()</span>
	<span class="n">o</span><span class="o">.</span><span class="n">erac</span><span class="p">(</span><span class="n">ofile</span><span class="p">)</span>	
	
	<span class="c1"># Corrects SED data points for new distance</span>
	<span class="n">o</span><span class="o">.</span><span class="n">nlnu</span><span class="o">=</span><span class="n">o</span><span class="o">.</span><span class="n">nlnu</span><span class="o">*</span><span class="p">(</span><span class="n">distratio</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
	<span class="n">o</span><span class="o">.</span><span class="n">nlnuex</span><span class="o">=</span><span class="n">o</span><span class="o">.</span><span class="n">nlnuex</span><span class="o">*</span><span class="p">(</span><span class="n">distratio</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
	<span class="n">o</span><span class="o">.</span><span class="n">ll</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">nlnu</span><span class="p">)</span>
	<span class="n">o</span><span class="o">.</span><span class="n">llex</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">nlnuex</span><span class="p">)</span>
	<span class="n">lumx</span><span class="o">=</span><span class="n">lumx</span><span class="o">*</span><span class="p">(</span><span class="n">distratio</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
		
	<span class="c1"># Separates the observed SED in the different bands and uses a different recipe</span>
	<span class="c1"># to plot each region</span>

	<span class="c1">## Radio and IR as filled points</span>
	<span class="n">rir</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">lognu</span><span class="o">&lt;</span><span class="mf">14.46</span><span class="p">)</span>
	<span class="n">pylab</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">lognu</span><span class="p">[</span><span class="n">rir</span><span class="p">],</span><span class="n">o</span><span class="o">.</span><span class="n">ll</span><span class="p">[</span><span class="n">rir</span><span class="p">],</span><span class="s1">&#39;ko&#39;</span><span class="p">)</span>

	<span class="c1">## Optical and UV (extinction uncertainty)</span>
	<span class="n">ouv</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">o</span><span class="o">.</span><span class="n">lognu</span><span class="o">&gt;=</span><span class="mf">14.46</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">lognu</span><span class="o">&lt;=</span><span class="mf">16.</span><span class="p">))</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">ouv</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">llex</span><span class="p">[</span><span class="n">ouv</span><span class="p">]</span><span class="o">-</span><span class="n">o</span><span class="o">.</span><span class="n">ll</span><span class="p">[</span><span class="n">ouv</span><span class="p">]</span><span class="o">&gt;</span><span class="mf">2.</span><span class="p">):</span>
		<span class="c1"># if the uncertainty in the UV due to extinction is too big (NGC 3169, NGC3226 and NGC4548), replace the &quot;error bar&quot; with an upper limit</span>
		<span class="n">pylab</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">lognu</span><span class="p">[</span><span class="n">ouv</span><span class="p">],</span><span class="n">o</span><span class="o">.</span><span class="n">llex</span><span class="p">[</span><span class="n">ouv</span><span class="p">],</span><span class="s1">&#39;ko&#39;</span><span class="p">)</span>
		<span class="n">pylab</span><span class="o">.</span><span class="n">quiver</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">lognu</span><span class="p">[</span><span class="n">ouv</span><span class="p">],</span><span class="n">o</span><span class="o">.</span><span class="n">llex</span><span class="p">[</span><span class="n">ouv</span><span class="p">],</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">scale</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="mf">3e-3</span><span class="p">)</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="k">if</span> <span class="n">ext</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span> 
			<span class="n">pylab</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">lognu</span><span class="p">[</span><span class="n">ouv</span><span class="p">],(</span><span class="n">o</span><span class="o">.</span><span class="n">ll</span><span class="p">[</span><span class="n">ouv</span><span class="p">]</span><span class="o">+</span><span class="n">o</span><span class="o">.</span><span class="n">llex</span><span class="p">[</span><span class="n">ouv</span><span class="p">])</span><span class="o">/</span><span class="mf">2.</span><span class="p">,</span><span class="n">yerr</span><span class="o">=</span><span class="n">o</span><span class="o">.</span><span class="n">llex</span><span class="p">[</span><span class="n">ouv</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">ll</span><span class="p">[</span><span class="n">ouv</span><span class="p">]</span><span class="o">+</span><span class="n">o</span><span class="o">.</span><span class="n">llex</span><span class="p">[</span><span class="n">ouv</span><span class="p">])</span><span class="o">/</span><span class="mf">2.</span><span class="p">,</span><span class="n">fmt</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">ecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;_nolegend_&#39;</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">pylab</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">lognu</span><span class="p">[</span><span class="n">ouv</span><span class="p">],</span><span class="n">o</span><span class="o">.</span><span class="n">ll</span><span class="p">[</span><span class="n">ouv</span><span class="p">],</span><span class="s1">&#39;ko&#39;</span><span class="p">)</span>
			<span class="n">pylab</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">lognu</span><span class="p">[</span><span class="n">ouv</span><span class="p">],(</span><span class="n">o</span><span class="o">.</span><span class="n">ll</span><span class="p">[</span><span class="n">ouv</span><span class="p">]</span><span class="o">+</span><span class="n">o</span><span class="o">.</span><span class="n">llex</span><span class="p">[</span><span class="n">ouv</span><span class="p">])</span><span class="o">/</span><span class="mf">2.</span><span class="p">,</span><span class="n">yerr</span><span class="o">=</span><span class="n">o</span><span class="o">.</span><span class="n">llex</span><span class="p">[</span><span class="n">ouv</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">ll</span><span class="p">[</span><span class="n">ouv</span><span class="p">]</span><span class="o">+</span><span class="n">o</span><span class="o">.</span><span class="n">llex</span><span class="p">[</span><span class="n">ouv</span><span class="p">])</span><span class="o">/</span><span class="mf">2.</span><span class="p">,</span><span class="n">fmt</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">ecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;_nolegend_&#39;</span><span class="p">)</span>
	
	<span class="c1">## X-rays as bow tie</span>
	<span class="n">xray</span><span class="p">(</span><span class="n">lumx</span><span class="p">,</span><span class="n">gammax</span><span class="p">,</span><span class="n">egammal</span><span class="p">,</span><span class="n">egammau</span><span class="p">)</span>	
	
	<span class="c1"># Upper limits with arrows</span>
	<span class="n">u</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">ul</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span>	<span class="c1"># index of upper limits</span>
	<span class="n">pylab</span><span class="o">.</span><span class="n">quiver</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">lognu</span><span class="p">[</span><span class="n">u</span><span class="p">],</span><span class="n">o</span><span class="o">.</span><span class="n">ll</span><span class="p">[</span><span class="n">u</span><span class="p">],</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">scale</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="mf">3e-3</span><span class="p">)</span>	<span class="c1"># careful with the arrow parameters	</span>

	<span class="c1"># Dummy plot just to include the name of the source with legend later</span>
	<span class="n">pylab</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">lognu</span><span class="o">+</span><span class="mi">50</span><span class="p">,</span><span class="n">o</span><span class="o">.</span><span class="n">ll</span><span class="p">,</span><span class="s1">&#39;w&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">source</span><span class="p">)</span>

	<span class="k">return</span> <span class="n">o</span></div>

	






<div class="viewcode-block" id="haydenobs"><a class="viewcode-back" href="../../nmmn.html#nmmn.sed.haydenobs">[docs]</a><span class="k">def</span> <span class="nf">haydenobs</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">patho</span><span class="o">=</span><span class="s1">&#39;/Users/nemmen/work/projects/hayden/all/&#39;</span><span class="p">,</span> <span class="n">info</span><span class="o">=</span><span class="s1">&#39;/Users/nemmen/work/projects/hayden/info.dat&#39;</span><span class="p">):</span>
<span class="w">	</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Plots the observed SED from the Hayden et al. sample. Includes arrows </span>
<span class="sd">for upper limits and the nice bow tie. </span>

<span class="sd">Extinction corrections represented as either &quot;error bars&quot; or &quot;circle + error bar&quot;.</span>

<span class="sd">:param source: source name e.g. &#39;NGC1097&#39; or &#39;ngc1097&#39; or &#39;NGC 1097&#39;. Must have four numbers.</span>
<span class="sd">:param patho: path to observed SED data files</span>
<span class="sd">:param info: path to information datafile with distances and masses</span>
<span class="sd">:returns: SED object </span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="c1"># Finds the required parameters to plot the data for the specified source.</span>
	<span class="c1"># First converts the source name to uppercase, no spaces</span>
	<span class="n">source</span><span class="o">=</span><span class="n">source</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
	<span class="n">source</span><span class="o">=</span><span class="n">source</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>

	<span class="c1"># Reads information table and gets required info</span>
	<span class="n">t</span><span class="o">=</span><span class="n">ascii</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">info</span><span class="p">)</span>
	<span class="n">names</span><span class="o">=</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
	<span class="c1"># finds location of source in the arrays</span>
	<span class="n">i</span><span class="o">=</span><span class="n">names</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
	<span class="c1"># gets distance </span>
	<span class="n">dist</span><span class="o">=</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;distance/Mpc&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>

	<span class="c1"># Reads observed SED (which is given in weird units)</span>
	<span class="n">ofile</span><span class="o">=</span><span class="n">patho</span><span class="o">+</span><span class="n">source</span><span class="o">+</span><span class="s1">&#39;_sed.txt&#39;</span>
	<span class="n">o</span><span class="o">=</span><span class="n">SED</span><span class="p">()</span>
	<span class="n">o</span><span class="o">.</span><span class="n">hayden</span><span class="p">(</span><span class="n">ofile</span><span class="p">,</span><span class="n">dist</span><span class="p">)</span>	
	
	<span class="c1">#########################################################	</span>
	<span class="c1"># Separates the observed SED in the different bands and uses a different recipe</span>
	<span class="c1"># to plot each region</span>
	<span class="c1">#########################################################	</span>

	<span class="n">pylab</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">lognu</span><span class="p">,</span><span class="n">o</span><span class="o">.</span><span class="n">ll</span><span class="p">,</span><span class="s1">&#39;ko&#39;</span><span class="p">)</span>
	
	<span class="c1">## X-rays as bow tie</span>
	<span class="c1">#xray(lumx,gammax,egammal,egammau)	</span>
	<span class="c1"># Reads Panessa&#39;s X-ray SED</span>
	<span class="n">xfile</span><span class="o">=</span><span class="n">patho</span><span class="o">+</span><span class="n">source</span><span class="o">+</span><span class="s1">&#39;_x.txt&#39;</span>
	<span class="n">x</span><span class="o">=</span><span class="n">SED</span><span class="p">()</span>
	<span class="n">x</span><span class="o">.</span><span class="n">haydenx</span><span class="p">(</span><span class="n">xfile</span><span class="p">)</span>	
	<span class="n">pylab</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">lognu</span><span class="p">,</span><span class="n">x</span><span class="o">.</span><span class="n">ll</span><span class="p">,</span><span class="s1">&#39;k.&#39;</span><span class="p">)</span>
	<span class="n">pylab</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">lognu</span><span class="p">,</span><span class="n">x</span><span class="o">.</span><span class="n">ll</span><span class="p">,</span><span class="n">yerr</span><span class="o">=</span><span class="n">x</span><span class="o">.</span><span class="n">llerr</span><span class="p">,</span><span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;_nolegend_&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>



	
	<span class="c1"># Upper limits with arrows</span>
	<span class="n">u</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">ul</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span>	<span class="c1"># index of upper limits</span>
	<span class="n">pylab</span><span class="o">.</span><span class="n">quiver</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">lognu</span><span class="p">[</span><span class="n">u</span><span class="p">],</span><span class="n">o</span><span class="o">.</span><span class="n">ll</span><span class="p">[</span><span class="n">u</span><span class="p">],</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">scale</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="mf">3e-3</span><span class="p">)</span>	<span class="c1"># careful with the arrow parameters	</span>

	<span class="c1"># Dummy plot just to include the name of the source with legend later</span>
	<span class="n">pylab</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">lognu</span><span class="o">+</span><span class="mi">50</span><span class="p">,</span><span class="n">o</span><span class="o">.</span><span class="n">ll</span><span class="p">,</span><span class="s1">&#39;w&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">source</span><span class="p">)</span>

	<span class="k">return</span> <span class="n">o</span></div>








<span class="c1"># ====================================</span>
<span class="c1">#</span>
<span class="c1"># Code below imported from sedplot.py</span>
<span class="c1">#</span>
<span class="c1"># ====================================</span>

<div class="viewcode-block" id="plotprops"><a class="viewcode-back" href="../../nmmn.html#nmmn.sed.plotprops">[docs]</a><span class="k">def</span> <span class="nf">plotprops</span><span class="p">(</span><span class="n">labelfontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">option</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">):</span>
<span class="w">	</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Define other properties of the SED plot: additional axis, font size etc.</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="c1"># Increase the size of the fonts</span>
	<span class="n">pylab</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;font.size&#39;</span><span class="p">:</span> <span class="mi">15</span><span class="p">})</span>

	<span class="c1"># Defines general properties of the plot</span>
	<span class="k">if</span> <span class="n">option</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
		<span class="n">pylab</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">20</span><span class="p">)</span> <span class="c1"># Nemmen et al. 2014 plots</span>
		<span class="n">pylab</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">35</span><span class="p">,</span><span class="mi">44</span><span class="p">)</span> <span class="c1"># Nemmen et al. 2014 plots</span>

	<span class="k">if</span> <span class="n">option</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span> 
		<span class="n">pylab</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">34</span><span class="p">,</span><span class="mi">40</span><span class="p">)</span> <span class="c1"># Hayden plots</span>
		<span class="n">pylab</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">19</span><span class="p">)</span>

	<span class="k">if</span> <span class="n">option</span><span class="o">==</span><span class="mi">3</span><span class="p">:</span>
		<span class="n">pylab</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">27</span><span class="p">)</span>	<span class="c1"># with Fermi data (large x-axis!)</span>

	<span class="n">pylab</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;log($</span><span class="se">\\</span><span class="s1">nu$ / Hz)&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="n">labelfontsize</span><span class="p">)</span>
	<span class="n">pylab</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;log($</span><span class="se">\\</span><span class="s1">nu L_</span><span class="se">\\</span><span class="s1">nu$ / erg s$^{-1}$)&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="n">labelfontsize</span><span class="p">)</span>
	<span class="n">pylab</span><span class="o">.</span><span class="n">minorticks_on</span><span class="p">()</span>
	<span class="k">if</span> <span class="n">legend</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
		<span class="n">pylab</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="n">loc</span><span class="p">,</span> <span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

	<span class="c1"># Add second X axis with common units of wavelength</span>
	<span class="n">ax1</span><span class="o">=</span><span class="n">pylab</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
	<span class="n">ax2</span><span class="o">=</span><span class="n">pylab</span><span class="o">.</span><span class="n">twiny</span><span class="p">()</span>
	<span class="n">pylab</span><span class="o">.</span><span class="n">minorticks_on</span><span class="p">()</span>

	<span class="k">if</span> <span class="n">option</span><span class="o">==</span><span class="mi">1</span> <span class="ow">or</span> <span class="n">option</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span>
		<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">20</span><span class="p">)</span>	
		<span class="n">ax2</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">20</span><span class="p">)</span>	<span class="c1"># set this to match the lower X axis</span>
		<span class="n">ax2</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([</span><span class="mf">8.477</span><span class="p">,</span><span class="mf">9.477</span><span class="p">,</span><span class="mf">10.477</span><span class="p">,</span><span class="mf">11.477</span><span class="p">,</span><span class="mf">12.477</span><span class="p">,</span><span class="mf">13.477</span><span class="p">,</span><span class="mf">14.477</span><span class="p">,</span><span class="mf">15.4768</span><span class="p">,</span><span class="mf">16.383</span><span class="p">,</span><span class="mf">17.383</span><span class="p">,</span><span class="mf">18.383</span><span class="p">,</span><span class="mf">19.383</span><span class="p">])</span>
		<span class="n">ax2</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([</span><span class="s1">&#39;1m&#39;</span><span class="p">,</span><span class="s1">&#39;10cm&#39;</span><span class="p">,</span><span class="s1">&#39;1cm&#39;</span><span class="p">,</span><span class="s1">&#39;1mm&#39;</span><span class="p">,</span><span class="s1">&#39;100$\mu$m&#39;</span><span class="p">,</span><span class="s1">&#39;10$\mu$m&#39;</span><span class="p">,</span><span class="s1">&#39;1$\mu$m&#39;</span><span class="p">,</span><span class="s1">&#39;1000$\AA$&#39;</span><span class="p">,</span><span class="s1">&#39;.1keV&#39;</span><span class="p">,</span><span class="s1">&#39;1keV&#39;</span><span class="p">,</span><span class="s1">&#39;10keV&#39;</span><span class="p">,</span><span class="s1">&#39;100keV&#39;</span><span class="p">],</span><span class="n">size</span><span class="o">=</span><span class="mf">10.5</span><span class="p">)</span>

	<span class="k">if</span> <span class="n">option</span><span class="o">==</span><span class="mi">3</span><span class="p">:</span>
		<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">27</span><span class="p">)</span>	
		<span class="n">ax2</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">27</span><span class="p">)</span>	<span class="c1"># set this to match the lower X axis</span>
		<span class="n">ax2</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([</span><span class="mf">8.477</span><span class="p">,</span><span class="mf">10.477</span><span class="p">,</span><span class="mf">12.477</span><span class="p">,</span><span class="mf">14.477</span><span class="p">,</span><span class="mf">16.383</span><span class="p">,</span><span class="mf">18.383</span><span class="p">,</span><span class="mf">20.383</span><span class="p">,</span><span class="mf">22.383</span><span class="p">,</span><span class="mf">24.383</span><span class="p">,</span><span class="mf">26.383</span><span class="p">])</span>
		<span class="n">ax2</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([</span><span class="s1">&#39;1m&#39;</span><span class="p">,</span><span class="s1">&#39;1cm&#39;</span><span class="p">,</span><span class="s1">&#39;100$\mu$m&#39;</span><span class="p">,</span><span class="s1">&#39;1$\mu$m&#39;</span><span class="p">,</span><span class="s1">&#39;0.1keV&#39;</span><span class="p">,</span><span class="s1">&#39;10keV&#39;</span><span class="p">,</span><span class="s1">&#39;1MeV&#39;</span><span class="p">,</span><span class="s1">&#39;100MeV&#39;</span><span class="p">,</span><span class="s1">&#39;10GeV&#39;</span><span class="p">,</span><span class="s1">&#39;1TeV&#39;</span><span class="p">],</span><span class="n">size</span><span class="o">=</span><span class="mf">10.5</span><span class="p">)</span></div>






<div class="viewcode-block" id="plot"><a class="viewcode-back" href="../../nmmn.html#nmmn.sed.plot">[docs]</a><span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="n">source</span><span class="p">,</span><span class="n">o</span><span class="p">,</span><span class="n">m</span><span class="p">,</span><span class="n">table</span><span class="p">):</span>
<span class="w">	</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">DEPRECATED. Split these method in separate units: modelplot, obsplot, plotprops.</span>
<span class="sd">Main method to create the SED plot.</span>

<span class="sd">Arguments:</span>
<span class="sd">- source: source name e.g. &#39;NGC1097&#39; or &#39;ngc1097&#39; or &#39;NGC 1097&#39;. Must have four </span>
<span class="sd">	numbers.</span>
<span class="sd">- o: observed SED data points imported using the SED class and the erac method.</span>
<span class="sd">- m: dictionary with the different model components created with the method</span>
<span class="sd">	groupmodel below.</span>
<span class="sd">- table: path of ASCII table models.csv with the required SED parameters gammax, </span>
<span class="sd">	error in gammax, X-ray luminosity and distratio.</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="c1"># Reads the ASCII table models.csv</span>
	<span class="n">t</span><span class="o">=</span><span class="n">ascii</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">table</span><span class="p">,</span><span class="n">Reader</span><span class="o">=</span><span class="n">ascii</span><span class="o">.</span><span class="n">CommentedHeader</span><span class="p">,</span><span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)</span>
	<span class="n">tname</span><span class="p">,</span><span class="n">tmodel</span><span class="p">,</span><span class="n">tdistratio</span><span class="p">,</span><span class="n">tgammax</span><span class="p">,</span><span class="n">tegammal</span><span class="p">,</span><span class="n">tegammau</span><span class="p">,</span><span class="n">tlumx</span><span class="o">=</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;Object&#39;</span><span class="p">],</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;Model&#39;</span><span class="p">],</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;distratio&#39;</span><span class="p">],</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;gammax&#39;</span><span class="p">],</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;egammal&#39;</span><span class="p">],</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;egammau&#39;</span><span class="p">],</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;lumx&#39;</span><span class="p">]</span>

	<span class="c1"># Finds the required parameters to plot the data for the specified source.</span>
	<span class="c1"># First converts the source name to uppercase, no spaces</span>
	<span class="n">source</span><span class="o">=</span><span class="n">source</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
	<span class="n">source</span><span class="o">=</span><span class="n">source</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
	<span class="c1"># Finds the first occurrence of the source in the table</span>
	<span class="n">i</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">tname</span><span class="o">==</span><span class="n">source</span><span class="p">)</span>
	<span class="n">i</span><span class="o">=</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
	<span class="c1"># Retrieves the required parameters</span>
	<span class="n">distratio</span><span class="o">=</span><span class="n">tdistratio</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
	<span class="n">gammax</span><span class="o">=</span><span class="n">tgammax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
	<span class="n">egammal</span><span class="o">=</span><span class="n">tegammal</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
	<span class="n">egammau</span><span class="o">=</span><span class="n">tegammau</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
	<span class="n">lumx</span><span class="o">=</span><span class="n">tlumx</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

	<span class="c1"># Precaution to avoid modifying unintentionally the obs SED</span>
	<span class="n">o</span><span class="o">=</span><span class="n">o</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
	
	


	<span class="n">pylab</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
	

	
	
	<span class="c1"># Plots OBSERVED SED</span>
	<span class="c1"># ====================</span>
	<span class="c1"># Corrects SED data points for new distance</span>
	<span class="n">o</span><span class="o">.</span><span class="n">nlnu</span><span class="o">=</span><span class="n">o</span><span class="o">.</span><span class="n">nlnu</span><span class="o">*</span><span class="p">(</span><span class="n">distratio</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
	<span class="n">o</span><span class="o">.</span><span class="n">nlnuex</span><span class="o">=</span><span class="n">o</span><span class="o">.</span><span class="n">nlnuex</span><span class="o">*</span><span class="p">(</span><span class="n">distratio</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
	<span class="n">o</span><span class="o">.</span><span class="n">ll</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">nlnu</span><span class="p">)</span>
	<span class="n">o</span><span class="o">.</span><span class="n">llex</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">nlnuex</span><span class="p">)</span>
	<span class="n">lumx</span><span class="o">=</span><span class="n">lumx</span><span class="o">*</span><span class="p">(</span><span class="n">distratio</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
		
	<span class="c1"># Separates the observed SED in the different bands and uses a different recipe</span>
	<span class="c1"># to plot each region</span>
	<span class="c1">## Radio and IR as filled points</span>
	<span class="n">rir</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">lognu</span><span class="o">&lt;</span><span class="mf">14.46</span><span class="p">)</span>
	<span class="n">pylab</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">lognu</span><span class="p">[</span><span class="n">rir</span><span class="p">],</span><span class="n">o</span><span class="o">.</span><span class="n">ll</span><span class="p">[</span><span class="n">rir</span><span class="p">],</span><span class="s1">&#39;ko&#39;</span><span class="p">)</span>
	<span class="c1">## Optical and UV as error bars (extinction uncertainty)</span>
	<span class="n">ouv</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">o</span><span class="o">.</span><span class="n">lognu</span><span class="o">&gt;=</span><span class="mf">14.46</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">lognu</span><span class="o">&lt;=</span><span class="mf">16.</span><span class="p">))</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">ouv</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">llex</span><span class="p">[</span><span class="n">ouv</span><span class="p">]</span><span class="o">-</span><span class="n">o</span><span class="o">.</span><span class="n">ll</span><span class="p">[</span><span class="n">ouv</span><span class="p">]</span><span class="o">&gt;</span><span class="mf">2.</span><span class="p">):</span>
		<span class="c1"># if the uncertainty in the UV due to extinction is too big (NGC 3169, NGC3226 and NGC4548), replace the &quot;error bar&quot; with an upper limit</span>
		<span class="n">pylab</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">lognu</span><span class="p">[</span><span class="n">ouv</span><span class="p">],</span><span class="n">o</span><span class="o">.</span><span class="n">llex</span><span class="p">[</span><span class="n">ouv</span><span class="p">],</span><span class="s1">&#39;ko&#39;</span><span class="p">)</span>
		<span class="n">pylab</span><span class="o">.</span><span class="n">quiver</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">lognu</span><span class="p">[</span><span class="n">ouv</span><span class="p">],</span><span class="n">o</span><span class="o">.</span><span class="n">llex</span><span class="p">[</span><span class="n">ouv</span><span class="p">],</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">scale</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="mf">3e-3</span><span class="p">)</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="n">pylab</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">lognu</span><span class="p">[</span><span class="n">ouv</span><span class="p">],(</span><span class="n">o</span><span class="o">.</span><span class="n">ll</span><span class="p">[</span><span class="n">ouv</span><span class="p">]</span><span class="o">+</span><span class="n">o</span><span class="o">.</span><span class="n">llex</span><span class="p">[</span><span class="n">ouv</span><span class="p">])</span><span class="o">/</span><span class="mf">2.</span><span class="p">,</span><span class="n">yerr</span><span class="o">=</span><span class="n">o</span><span class="o">.</span><span class="n">llex</span><span class="p">[</span><span class="n">ouv</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">ll</span><span class="p">[</span><span class="n">ouv</span><span class="p">]</span><span class="o">+</span><span class="n">o</span><span class="o">.</span><span class="n">llex</span><span class="p">[</span><span class="n">ouv</span><span class="p">])</span><span class="o">/</span><span class="mf">2.</span><span class="p">,</span><span class="n">fmt</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">ecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;_nolegend_&#39;</span><span class="p">)</span>
	<span class="c1">## X-rays as bow tie</span>
	<span class="n">xray</span><span class="p">(</span><span class="n">lumx</span><span class="p">,</span><span class="n">gammax</span><span class="p">,</span><span class="n">egammal</span><span class="p">,</span><span class="n">egammau</span><span class="p">)</span>	
	
	<span class="c1"># Upper limits with arrows</span>
	<span class="n">u</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">ul</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span>	<span class="c1"># index of upper limits</span>
	<span class="n">pylab</span><span class="o">.</span><span class="n">quiver</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">lognu</span><span class="p">[</span><span class="n">u</span><span class="p">],</span><span class="n">o</span><span class="o">.</span><span class="n">ll</span><span class="p">[</span><span class="n">u</span><span class="p">],</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">scale</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="mf">3e-3</span><span class="p">)</span>	<span class="c1"># careful with the arrow parameters	</span>

	<span class="c1"># Dummy plot just to include the name of the source with legend later</span>
	<span class="n">pylab</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">lognu</span><span class="o">+</span><span class="mi">50</span><span class="p">,</span><span class="n">o</span><span class="o">.</span><span class="n">ll</span><span class="p">,</span><span class="s1">&#39;w&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">source</span><span class="p">)</span>

	
	

	<span class="c1"># Plots MODEL SEDs</span>
	<span class="c1"># ==================</span>
	<span class="c1"># Please be sure that m was created with the groupmodel method</span>
	
	<span class="k">if</span> <span class="s1">&#39;sum&#39;</span> <span class="ow">in</span> <span class="n">m</span><span class="p">:</span> <span class="n">pylab</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="s1">&#39;sum&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lognu</span><span class="p">,</span><span class="n">m</span><span class="p">[</span><span class="s1">&#39;sum&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">ll</span><span class="p">,</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
	<span class="k">if</span> <span class="s1">&#39;adaf&#39;</span> <span class="ow">in</span> <span class="n">m</span><span class="p">:</span> <span class="n">pylab</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="s1">&#39;adaf&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lognu</span><span class="p">,</span><span class="n">m</span><span class="p">[</span><span class="s1">&#39;adaf&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">ll</span><span class="p">,</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
	<span class="k">if</span> <span class="s1">&#39;jet&#39;</span> <span class="ow">in</span> <span class="n">m</span><span class="p">:</span> <span class="n">pylab</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="s1">&#39;jet&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lognu</span><span class="p">,</span><span class="n">m</span><span class="p">[</span><span class="s1">&#39;jet&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">ll</span><span class="p">,</span><span class="s1">&#39;-.&#39;</span><span class="p">)</span>
	<span class="k">if</span> <span class="s1">&#39;ssd&#39;</span> <span class="ow">in</span> <span class="n">m</span><span class="p">:</span> <span class="n">pylab</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="s1">&#39;ssd&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lognu</span><span class="p">,</span><span class="n">m</span><span class="p">[</span><span class="s1">&#39;ssd&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">ll</span><span class="p">,</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>



	
	<span class="c1"># Defines general properties of the plot</span>
	<span class="n">pylab</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">20</span><span class="p">)</span>
	<span class="n">pylab</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">35</span><span class="p">,</span><span class="mi">44</span><span class="p">)</span>
	<span class="n">pylab</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;log($</span><span class="se">\\</span><span class="s1">nu$ / Hz)&#39;</span><span class="p">)</span>
	<span class="n">pylab</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;log($</span><span class="se">\\</span><span class="s1">nu L_</span><span class="se">\\</span><span class="s1">nu$ / erg s$^{-1}$)&#39;</span><span class="p">)</span>
	<span class="n">pylab</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">)</span>
	<span class="n">pylab</span><span class="o">.</span><span class="n">minorticks_on</span><span class="p">()</span>
	<span class="n">pylab</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">,</span> <span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

	<span class="c1"># Add second X axis with common units of wavelength</span>
	<span class="n">ax1</span><span class="o">=</span><span class="n">pylab</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
	<span class="n">ax2</span><span class="o">=</span><span class="n">pylab</span><span class="o">.</span><span class="n">twiny</span><span class="p">()</span>
	<span class="n">ax2</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">20</span><span class="p">)</span>	<span class="c1"># set this to match the lower X axis</span>
	<span class="n">ax2</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([</span><span class="mf">8.477</span><span class="p">,</span><span class="mf">9.477</span><span class="p">,</span><span class="mf">10.477</span><span class="p">,</span><span class="mf">11.477</span><span class="p">,</span><span class="mf">12.477</span><span class="p">,</span><span class="mf">13.477</span><span class="p">,</span><span class="mf">14.477</span><span class="p">,</span><span class="mf">15.4768</span><span class="p">,</span><span class="mf">16.383</span><span class="p">,</span><span class="mf">17.383</span><span class="p">,</span><span class="mf">18.383</span><span class="p">,</span><span class="mf">19.383</span><span class="p">])</span>
	<span class="n">ax2</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([</span><span class="s1">&#39;1m&#39;</span><span class="p">,</span><span class="s1">&#39;10cm&#39;</span><span class="p">,</span><span class="s1">&#39;1cm&#39;</span><span class="p">,</span><span class="s1">&#39;1mm&#39;</span><span class="p">,</span><span class="s1">&#39;100$\mu$m&#39;</span><span class="p">,</span><span class="s1">&#39;10$\mu$m&#39;</span><span class="p">,</span><span class="s1">&#39;1$\mu$m&#39;</span><span class="p">,</span><span class="s1">&#39;1000$\AA$&#39;</span><span class="p">,</span><span class="s1">&#39;.1keV&#39;</span><span class="p">,</span><span class="s1">&#39;1keV&#39;</span><span class="p">,</span><span class="s1">&#39;10keV&#39;</span><span class="p">,</span><span class="s1">&#39;100keV&#39;</span><span class="p">],</span><span class="n">size</span><span class="o">=</span><span class="mf">10.5</span><span class="p">)</span>
	<span class="n">pylab</span><span class="o">.</span><span class="n">minorticks_on</span><span class="p">()</span>

	<span class="n">pylab</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span></div>
	<span class="c1">#pylab.show()</span>




<div class="viewcode-block" id="groupmodel"><a class="viewcode-back" href="../../nmmn.html#nmmn.sed.groupmodel">[docs]</a><span class="k">def</span> <span class="nf">groupmodel</span><span class="p">(</span><span class="nb">sum</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">ssd</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">jet</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">adaf</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">	</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Groups the different components of a SED model into one dictionary for convenient</span>
<span class="sd">access. The model component SEDs are assumed to have been imported using the</span>
<span class="sd">SED class. This method is used in the plot method.</span>

<span class="sd">Example:</span>

<span class="sd">Imports the model SEDs:</span>
<span class="sd">&gt;&gt;&gt; s=SED(file=&#39;sum.dat&#39;, logfmt=1)</span>
<span class="sd">&gt;&gt;&gt; disk=SED(file=&#39;disk.dat&#39;, logfmt=1)</span>
<span class="sd">&gt;&gt;&gt; a=SED(file=&#39;adaf.dat&#39;, logfmt=1)</span>

<span class="sd">Groups them together in a dictionary d:</span>
<span class="sd">&gt;&gt;&gt; d=groupmodel(sum=s,ssd=disk,adaf=a)</span>
<span class="sd">returning {&#39;sum&#39;:s,&#39;ssd&#39;:disk,&#39;adaf&#39;:a}. </span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="n">m</span><span class="o">=</span><span class="p">{}</span>	<span class="c1"># empty dictionary</span>
	
	<span class="k">if</span> <span class="nb">sum</span><span class="o">!=</span><span class="kc">None</span><span class="p">:</span> <span class="n">m</span><span class="p">[</span><span class="s1">&#39;sum&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">sum</span>
	<span class="k">if</span> <span class="n">ssd</span><span class="o">!=</span><span class="kc">None</span><span class="p">:</span> <span class="n">m</span><span class="p">[</span><span class="s1">&#39;ssd&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">ssd</span>
	<span class="k">if</span> <span class="n">jet</span><span class="o">!=</span><span class="kc">None</span><span class="p">:</span> <span class="n">m</span><span class="p">[</span><span class="s1">&#39;jet&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">jet</span>
	<span class="k">if</span> <span class="n">adaf</span><span class="o">!=</span><span class="kc">None</span><span class="p">:</span> <span class="n">m</span><span class="p">[</span><span class="s1">&#39;adaf&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">adaf</span>
	
	<span class="k">return</span> <span class="n">m</span></div>




<div class="viewcode-block" id="obsplot1097"><a class="viewcode-back" href="../../nmmn.html#nmmn.sed.obsplot1097">[docs]</a><span class="k">def</span> <span class="nf">obsplot1097</span><span class="p">(</span><span class="n">source</span><span class="p">,</span><span class="n">o</span><span class="p">,</span><span class="n">table</span><span class="p">):</span>
<span class="w">	</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Modification of the plot method to handle the nice data of NGC 1097.</span>

<span class="sd">:param source: source name e.g. &#39;NGC1097&#39; or &#39;ngc1097&#39; or &#39;NGC 1097&#39;. Must have four numbers.</span>
<span class="sd">:param o: observed SED data points imported using the SED class and the erac method.</span>
<span class="sd">:param table: path of ASCII table models.csv with the required SED parameters gammax, error in gammax, X-ray luminosity and distratio.</span>
<span class="sd">:returns: SED object with distance-corrected luminosities</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="c1"># Reads the ASCII table models.csv</span>
	<span class="n">t</span><span class="o">=</span><span class="n">ascii</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">table</span><span class="p">,</span><span class="n">Reader</span><span class="o">=</span><span class="n">ascii</span><span class="o">.</span><span class="n">CommentedHeader</span><span class="p">,</span><span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)</span>
	<span class="n">tname</span><span class="p">,</span><span class="n">tmodel</span><span class="p">,</span><span class="n">tdistratio</span><span class="p">,</span><span class="n">tgammax</span><span class="p">,</span><span class="n">tegammal</span><span class="p">,</span><span class="n">tegammau</span><span class="p">,</span><span class="n">tlumx</span><span class="o">=</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;Object&#39;</span><span class="p">],</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;Model&#39;</span><span class="p">],</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;distratio&#39;</span><span class="p">],</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;gammax&#39;</span><span class="p">],</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;egammal&#39;</span><span class="p">],</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;egammau&#39;</span><span class="p">],</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;lumx&#39;</span><span class="p">]</span>

	<span class="c1"># Finds the required parameters to plot the data for the specified source.</span>
	<span class="c1"># First converts the source name to uppercase, no spaces</span>
	<span class="n">source</span><span class="o">=</span><span class="n">source</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
	<span class="n">source</span><span class="o">=</span><span class="n">source</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
	<span class="c1"># Finds the first occurrence of the source in the table</span>
	<span class="n">i</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">tname</span><span class="o">==</span><span class="n">source</span><span class="p">)</span>
	<span class="n">i</span><span class="o">=</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
	<span class="c1"># Retrieves the required parameters</span>
	<span class="n">distratio</span><span class="o">=</span><span class="n">tdistratio</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
	<span class="n">gammax</span><span class="o">=</span><span class="n">tgammax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
	<span class="n">egammal</span><span class="o">=</span><span class="n">tegammal</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
	<span class="n">egammau</span><span class="o">=</span><span class="n">tegammau</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
	<span class="n">lumx</span><span class="o">=</span><span class="n">tlumx</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

	<span class="c1"># Precaution to avoid modifying unintentionally the obs SED</span>
	<span class="c1">#o=o.copy()</span>

	<span class="n">pylab</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
	
	<span class="c1"># Plots OBSERVED SED</span>
	<span class="c1"># ====================</span>
	<span class="c1"># Corrects SED data points for new distance</span>
	<span class="c1">#o.nlnu=o.nlnu*(distratio)**2</span>
	<span class="c1">#o.ll=numpy.log10(o.nlnu)</span>
	<span class="c1">#lumx=lumx*(distratio)**2</span>
		
	<span class="c1"># Separates the observed SED in the different bands and uses a different recipe</span>
	<span class="c1"># to plot each region</span>
	<span class="c1"># Radio and IR as filled points</span>
	<span class="n">rir</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">lognu</span><span class="o">&lt;</span><span class="mf">14.46</span><span class="p">)</span>
	<span class="n">pylab</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">lognu</span><span class="p">[</span><span class="n">rir</span><span class="p">],</span><span class="n">o</span><span class="o">.</span><span class="n">ll</span><span class="p">[</span><span class="n">rir</span><span class="p">],</span><span class="s1">&#39;ko&#39;</span><span class="p">)</span>
	
	<span class="c1"># Optical and UV as solid line</span>
	<span class="n">ouv</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">o</span><span class="o">.</span><span class="n">lognu</span><span class="o">&gt;=</span><span class="mf">14.46</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">lognu</span><span class="o">&lt;=</span><span class="mf">16.</span><span class="p">))</span>	
	<span class="n">pylab</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">lognu</span><span class="p">[</span><span class="n">ouv</span><span class="p">],</span><span class="n">o</span><span class="o">.</span><span class="n">ll</span><span class="p">[</span><span class="n">ouv</span><span class="p">],</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
	
	<span class="n">pylab</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
	
	<span class="c1"># X-rays as bow tie</span>
	<span class="n">xray</span><span class="p">(</span><span class="n">lumx</span><span class="p">,</span><span class="n">gammax</span><span class="p">,</span><span class="n">egammal</span><span class="p">,</span><span class="n">egammau</span><span class="p">)</span>	
	
	<span class="c1"># Upper limits with arrows</span>
	<span class="n">u</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">o</span><span class="o">.</span><span class="n">lognu</span><span class="o">&gt;=</span><span class="mi">10</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">lognu</span><span class="o">&lt;=</span><span class="mf">14.46</span><span class="p">))</span>	<span class="c1"># index of IR upper limits</span>
	<span class="n">pylab</span><span class="o">.</span><span class="n">quiver</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">lognu</span><span class="p">[</span><span class="n">u</span><span class="p">],</span><span class="n">o</span><span class="o">.</span><span class="n">ll</span><span class="p">[</span><span class="n">u</span><span class="p">],</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">scale</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="mf">3e-3</span><span class="p">)</span>	<span class="c1"># careful with the arrow parameters	</span>

	<span class="c1"># Dummy plot just to include the name of the source with legend later</span>
	<span class="n">pylab</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">lognu</span><span class="o">+</span><span class="mi">50</span><span class="p">,</span><span class="n">o</span><span class="o">.</span><span class="n">ll</span><span class="p">,</span><span class="s1">&#39;w&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">source</span><span class="p">)</span>

	<span class="k">return</span> <span class="n">o</span></div>

	


<div class="viewcode-block" id="xray"><a class="viewcode-back" href="../../nmmn.html#nmmn.sed.xray">[docs]</a><span class="k">def</span> <span class="nf">xray</span><span class="p">(</span><span class="n">L2_10</span><span class="p">,</span> <span class="n">gammax</span><span class="p">,</span> <span class="n">gammaerru</span><span class="p">,</span> <span class="n">gammaerrl</span><span class="p">,</span> <span class="n">nurange</span><span class="o">=</span><span class="p">[</span><span class="mf">2.</span><span class="p">,</span><span class="mf">10.</span><span class="p">],</span> <span class="o">**</span><span class="n">args</span><span class="p">):</span>
<span class="w">	</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Plots X-ray &quot;bow tie&quot;, provided the X-ray luminosity in the 2-10 keV range,</span>
<span class="sd">the best-fit photon index and the error in this index.</span>

<span class="sd">Arguments:</span>
<span class="sd">- L2_10: X-ray luminosity in the 2-10 keV range, erg/s</span>
<span class="sd">- gammax: best-fit photon index</span>
<span class="sd">- gammaerru, gammaerrl: upper and lower 1sigma error bars on the value of</span>
<span class="sd">  gammax</span>
<span class="sd"> - nurange: two-element list or array with range of frequencies to plot, </span>
<span class="sd">  in keV. e.g. [2,10]</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="c1"># Retrieves current axis limits</span>
	<span class="n">xy</span><span class="o">=</span><span class="n">pylab</span><span class="o">.</span><span class="n">axis</span><span class="p">()</span>

	<span class="c1"># Creates vectors containing the X-ray powerlaws and plots them</span>
	<span class="n">lognu</span><span class="p">,</span><span class="n">nuLbest</span><span class="o">=</span><span class="n">powerlaw</span><span class="p">(</span><span class="n">gammax</span><span class="o">-</span><span class="mf">1.</span><span class="p">,</span><span class="n">L2_10</span><span class="p">,</span><span class="n">nurange</span><span class="p">)</span>	<span class="c1"># best-fit</span>
	<span class="n">lognu</span><span class="p">,</span><span class="n">nuLlow</span><span class="o">=</span><span class="n">powerlaw</span><span class="p">(</span><span class="n">gammax</span><span class="o">-</span><span class="n">gammaerrl</span><span class="o">-</span><span class="mf">1.</span><span class="p">,</span><span class="n">L2_10</span><span class="p">,</span><span class="n">nurange</span><span class="p">)</span>	<span class="c1"># lower</span>
	<span class="n">lognu</span><span class="p">,</span><span class="n">nuLup</span><span class="o">=</span><span class="n">powerlaw</span><span class="p">(</span><span class="n">gammax</span><span class="o">+</span><span class="n">gammaerru</span><span class="o">-</span><span class="mf">1.</span><span class="p">,</span><span class="n">L2_10</span><span class="p">,</span><span class="n">nurange</span><span class="p">)</span>	<span class="c1"># upper</span>

	<span class="n">pylab</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">lognu</span><span class="p">,</span> <span class="n">nuLlow</span><span class="p">,</span> <span class="n">nuLup</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
	<span class="n">pylab</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lognu</span><span class="p">,</span> <span class="n">nuLbest</span><span class="p">,</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">2.5</span><span class="p">,</span> <span class="o">**</span><span class="n">args</span><span class="p">)</span></div>
	




<div class="viewcode-block" id="powerlaw"><a class="viewcode-back" href="../../nmmn.html#nmmn.sed.powerlaw">[docs]</a><span class="k">def</span> <span class="nf">powerlaw</span><span class="p">(</span><span class="n">alpha</span><span class="p">,</span><span class="n">Lx</span><span class="p">,</span><span class="n">nurange</span><span class="p">,</span><span class="n">npoints</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
<span class="w">	</span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">Calculates the X-ray powerlaw variables. </span>

<span class="sd">Arguments:</span>
<span class="sd">- alpha: spectral power-law index</span>
<span class="sd">- Lx: total luminosity in X-rays in the nurange</span>
<span class="sd"> - nurange: two-element list or array with range of frequencies to plot, </span>
<span class="sd">  in keV. e.g. [2,10]</span>

<span class="sd">Returns the sequence of arrays log10(nu),log10(nu*Lnu) for plotting.</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="n">h</span><span class="o">=</span><span class="mf">0.6626e-26</span> <span class="c1"># Planck constant (CGS)</span>
	<span class="n">conv</span><span class="o">=</span><span class="mf">1.602171e-9</span><span class="o">/</span><span class="n">h</span> <span class="c1"># conversion factor keV -&gt; Hz</span>
	<span class="n">nu0</span><span class="o">=</span><span class="n">nurange</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">conv</span> <span class="c1"># nu_i from keV -&gt; Hz</span>
		
	<span class="c1"># Creates a vector of frequencies</span>
	<span class="n">points</span><span class="p">,</span><span class="n">nui</span><span class="p">,</span><span class="n">nuf</span> <span class="o">=</span> <span class="n">npoints</span><span class="p">,</span><span class="n">nu0</span><span class="p">,</span><span class="n">nurange</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">conv</span>	<span class="c1"># e.g. 2 keV - 10 keV</span>
	<span class="n">nu</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">nui</span><span class="p">,</span><span class="n">nuf</span><span class="p">,</span><span class="n">points</span><span class="p">)</span>
	
	<span class="c1"># Takes into account the possibility of alpha=1 which changes the way you</span>
	<span class="c1"># calculate (integrate) the total X-ray luminosity from the power-law</span>
	<span class="k">if</span> <span class="nb">round</span><span class="p">(</span><span class="n">alpha</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">!=</span><span class="mf">1.</span> <span class="p">:</span>
		<span class="n">L0</span><span class="o">=</span><span class="n">nu0</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">alpha</span><span class="p">)</span><span class="o">*</span><span class="n">Lx</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span><span class="o">-</span><span class="n">alpha</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">nuf</span><span class="o">**</span><span class="p">(</span><span class="mf">1.</span><span class="o">-</span><span class="n">alpha</span><span class="p">)</span><span class="o">-</span><span class="n">nui</span><span class="o">**</span><span class="p">(</span><span class="mf">1.</span><span class="o">-</span><span class="n">alpha</span><span class="p">))</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="n">L0</span><span class="o">=</span><span class="n">nu0</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">alpha</span><span class="p">)</span><span class="o">*</span><span class="n">Lx</span><span class="o">/</span><span class="n">numpy</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">nuf</span><span class="o">/</span><span class="n">nui</span><span class="p">)</span>
		
	<span class="n">Lnu</span><span class="o">=</span><span class="n">L0</span><span class="o">*</span><span class="p">(</span><span class="n">nu</span><span class="o">/</span><span class="n">nu0</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">alpha</span><span class="p">)</span>

	<span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">nu</span><span class="p">),</span> <span class="n">numpy</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">nu</span><span class="o">*</span><span class="n">Lnu</span><span class="p">)</span></div>





<div class="viewcode-block" id="xrayinset"><a class="viewcode-back" href="../../nmmn.html#nmmn.sed.xrayinset">[docs]</a><span class="k">def</span> <span class="nf">xrayinset</span><span class="p">(</span><span class="n">source</span><span class="p">,</span><span class="n">ssdf</span><span class="p">,</span><span class="n">adaff</span><span class="p">,</span><span class="n">jetf</span><span class="p">,</span><span class="n">sumf</span><span class="p">,</span>
	<span class="n">table</span><span class="o">=</span><span class="s1">&#39;/Users/nemmen/Dropbox/work/projects/finished/liners/tables/models.csv&#39;</span><span class="p">,</span>
	<span class="o">**</span><span class="n">args</span>
	<span class="p">):</span>
<span class="w">	</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Plots an inset with the zoomed-in X-ray spectra.</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="c1"># This piece of code was quickly and dirty copied from the obsplot method,</span>
	<span class="c1"># in order to plot the X-ray bowtie</span>
	<span class="c1"># ========================= BEGIN</span>

	<span class="c1"># Reads the ASCII table models.csv</span>
	<span class="n">t</span><span class="o">=</span><span class="n">ascii</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">table</span><span class="p">,</span><span class="n">Reader</span><span class="o">=</span><span class="n">ascii</span><span class="o">.</span><span class="n">CommentedHeader</span><span class="p">,</span><span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)</span>
	<span class="n">tname</span><span class="p">,</span><span class="n">tmodel</span><span class="p">,</span><span class="n">tdistratio</span><span class="p">,</span><span class="n">tgammax</span><span class="p">,</span><span class="n">tegammal</span><span class="p">,</span><span class="n">tegammau</span><span class="p">,</span><span class="n">tlumx</span><span class="o">=</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;Object&#39;</span><span class="p">],</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;Model&#39;</span><span class="p">],</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;distratio&#39;</span><span class="p">],</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;gammax&#39;</span><span class="p">],</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;egammal&#39;</span><span class="p">],</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;egammau&#39;</span><span class="p">],</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;lumx&#39;</span><span class="p">]</span>

	<span class="c1"># Finds the required parameters to plot the data for the specified source.</span>
	<span class="c1"># First converts the source name to uppercase, no spaces</span>
	<span class="n">source</span><span class="o">=</span><span class="n">source</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
	<span class="n">source</span><span class="o">=</span><span class="n">source</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
	<span class="c1"># Finds the first occurrence of the source in the table</span>
	<span class="n">i</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">tname</span><span class="o">==</span><span class="n">source</span><span class="p">)</span>
	<span class="n">i</span><span class="o">=</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
	<span class="c1"># Retrieves the required parameters</span>
	<span class="n">distratio</span><span class="o">=</span><span class="n">tdistratio</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
	<span class="n">gammax</span><span class="o">=</span><span class="n">tgammax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
	<span class="n">egammal</span><span class="o">=</span><span class="n">tegammal</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
	<span class="n">egammau</span><span class="o">=</span><span class="n">tegammau</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
	<span class="n">lumx</span><span class="o">=</span><span class="n">tlumx</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

	<span class="c1"># Corrects Lx for new distance</span>
	<span class="n">lumx</span><span class="o">=</span><span class="n">lumx</span><span class="o">*</span><span class="p">(</span><span class="n">distratio</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
	<span class="c1"># ========================= END</span>

	<span class="c1"># Gets central Lx</span>
	<span class="n">lognu</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">powerlaw</span><span class="p">(</span><span class="n">gammax</span><span class="o">-</span><span class="n">egammal</span><span class="o">-</span><span class="mf">1.</span><span class="p">,</span><span class="n">lumx</span><span class="p">)</span>

	<span class="c1"># Creates the inset</span>
	<span class="k">if</span> <span class="n">numpy</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">38.</span><span class="p">:</span>
		<span class="c1"># precaution for NGC 3379, which has a very low Lx and hence the inset hides the main plot</span>
		<span class="n">pylab</span><span class="o">.</span><span class="n">axes</span><span class="p">([</span><span class="mf">0.7</span><span class="p">,</span><span class="mf">0.6</span><span class="p">,</span><span class="mf">0.17</span><span class="p">,</span><span class="mf">0.17</span><span class="p">])</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="n">pylab</span><span class="o">.</span><span class="n">axes</span><span class="p">([</span><span class="mf">0.7</span><span class="p">,</span><span class="mf">0.15</span><span class="p">,</span><span class="mf">0.17</span><span class="p">,</span><span class="mf">0.17</span><span class="p">])</span>
	<span class="n">pylab</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mf">17.65</span><span class="p">,</span><span class="mf">18.4</span><span class="p">)</span>
	<span class="n">pylab</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span><span class="n">y</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">+</span><span class="mf">0.1</span><span class="p">)</span>
	<span class="n">pylab</span><span class="o">.</span><span class="n">xticks</span><span class="p">([])</span>
	<span class="n">pylab</span><span class="o">.</span><span class="n">yticks</span><span class="p">([])</span>

	<span class="c1">## X-rays as bow tie</span>
	<span class="n">xray</span><span class="p">(</span><span class="n">lumx</span><span class="p">,</span><span class="n">gammax</span><span class="p">,</span><span class="n">egammal</span><span class="p">,</span><span class="n">egammau</span><span class="p">,</span><span class="o">**</span><span class="n">args</span><span class="p">)</span>


	<span class="c1"># Now the piece of code below was copied from the modelplot method.</span>
	<span class="c1"># Plots the model components.</span>
	<span class="c1"># ========================= BEGIN</span>


	<span class="c1"># Reads model SEDs, checking first if the data files exist</span>
	<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">sumf</span><span class="p">):</span> <span class="n">msum</span><span class="o">=</span><span class="n">SED</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="n">sumf</span><span class="p">,</span><span class="n">logfmt</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> 
	<span class="k">else</span><span class="p">:</span> <span class="n">msum</span><span class="o">=</span><span class="kc">None</span>
	<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">adaff</span><span class="p">):</span> <span class="n">adaf</span><span class="o">=</span><span class="n">SED</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="n">adaff</span><span class="p">,</span><span class="n">logfmt</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> 
	<span class="k">else</span><span class="p">:</span> <span class="n">adaf</span><span class="o">=</span><span class="kc">None</span>
	<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">jetf</span><span class="p">):</span> <span class="n">jet</span><span class="o">=</span><span class="n">SED</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="n">jetf</span><span class="p">,</span><span class="n">logfmt</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> 
	<span class="k">else</span><span class="p">:</span> <span class="n">jet</span><span class="o">=</span><span class="kc">None</span>
	<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">ssdf</span><span class="p">):</span> <span class="n">ssd</span><span class="o">=</span><span class="n">SED</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="n">ssdf</span><span class="p">,</span><span class="n">logfmt</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> 
	<span class="k">else</span><span class="p">:</span> <span class="n">ssd</span><span class="o">=</span><span class="kc">None</span>
	
	<span class="c1"># Groups the model components in a dictionary</span>
	<span class="n">m</span><span class="o">=</span><span class="n">groupmodel</span><span class="p">(</span><span class="nb">sum</span><span class="o">=</span><span class="n">msum</span><span class="p">,</span><span class="n">ssd</span><span class="o">=</span><span class="n">ssd</span><span class="p">,</span><span class="n">adaf</span><span class="o">=</span><span class="n">adaf</span><span class="p">,</span><span class="n">jet</span><span class="o">=</span><span class="n">jet</span><span class="p">)</span>

	<span class="k">if</span> <span class="s1">&#39;sum&#39;</span> <span class="ow">in</span> <span class="n">m</span><span class="p">:</span> <span class="n">pylab</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="s1">&#39;sum&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lognu</span><span class="p">,</span><span class="n">m</span><span class="p">[</span><span class="s1">&#39;sum&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">ll</span><span class="p">,</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
	<span class="k">if</span> <span class="s1">&#39;adaf&#39;</span> <span class="ow">in</span> <span class="n">m</span><span class="p">:</span> <span class="n">pylab</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="s1">&#39;adaf&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lognu</span><span class="p">,</span><span class="n">m</span><span class="p">[</span><span class="s1">&#39;adaf&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">ll</span><span class="p">,</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
	<span class="k">if</span> <span class="s1">&#39;jet&#39;</span> <span class="ow">in</span> <span class="n">m</span><span class="p">:</span> <span class="n">pylab</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="s1">&#39;jet&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lognu</span><span class="p">,</span><span class="n">m</span><span class="p">[</span><span class="s1">&#39;jet&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">ll</span><span class="p">,</span><span class="s1">&#39;-.&#39;</span><span class="p">)</span>
	<span class="k">if</span> <span class="s1">&#39;ssd&#39;</span> <span class="ow">in</span> <span class="n">m</span><span class="p">:</span> <span class="n">pylab</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="s1">&#39;ssd&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lognu</span><span class="p">,</span><span class="n">m</span><span class="p">[</span><span class="s1">&#39;ssd&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">ll</span><span class="p">,</span><span class="s1">&#39;:&#39;</span><span class="p">)</span></div>
	<span class="c1"># ========================= END</span>







<div class="viewcode-block" id="popstar"><a class="viewcode-back" href="../../nmmn.html#nmmn.sed.popstar">[docs]</a><span class="k">def</span> <span class="nf">popstar</span><span class="p">(</span><span class="n">o</span><span class="p">):</span>
<span class="w">	</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Fits the stellar population spectrum, finds the required mass and plots its</span>
<span class="sd">SED.</span>

<span class="sd">:param o: object containing the observed SED</span>
<span class="sd">:returns: fitted stellar population mass</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="c1"># Gets the optical-UV points (SELECT THE FREQUENCY RANGE)</span>
	<span class="n">ouv</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">o</span><span class="o">.</span><span class="n">lognu</span><span class="o">&gt;=</span><span class="mf">14.46</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">lognu</span><span class="o">&lt;=</span><span class="mf">14.87</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">ul</span><span class="o">==</span><span class="mi">0</span><span class="p">))</span>
	<span class="c1">#pylab.plot(o.lognu[ouv],o.ll[ouv],&#39;ro&#39;)</span>

	<span class="c1"># Reads stellar population sed</span>
	<span class="c1">#xx,yy = numpy.loadtxt(&#39;/Users/nemmen/Dropbox/work/projects/finished/liners/seds/popstar/bruzual/bc2003_hr_m62_salp_ssp_181.spec&#39;,unpack=True,usecols=(0,1))</span>
	<span class="n">xx</span><span class="p">,</span><span class="n">yy</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="s1">&#39;/Users/nemmen/Dropbox/work/projects/finished/liners/seds/popstar/bruzual/Sed_Mar05_Z_0.02_Age_10.00000000.dat&#39;</span><span class="p">,</span><span class="n">unpack</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">usecols</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
	<span class="n">xpop</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="mf">29979245800.</span><span class="o">/</span><span class="p">(</span><span class="n">xx</span><span class="o">*</span><span class="mf">1e-8</span><span class="p">))</span> <span class="c1"># AA to cm to Hz</span>
	<span class="n">ypop</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">xx</span><span class="o">*</span><span class="n">yy</span><span class="o">*</span><span class="mf">3.826e33</span><span class="p">)</span>	<span class="c1"># Lsun/AA -&gt; erg/s</span>

	<span class="c1"># Fits popstar to OUV data</span>
	<span class="c1"># only fits if number of OUV points &gt; 0</span>
	<span class="n">ff</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span><span class="n">a</span><span class="p">:</span> <span class="n">f</span><span class="p">(</span><span class="n">xpop</span><span class="p">,</span><span class="n">ypop</span><span class="p">,</span><span class="n">x</span><span class="p">)</span><span class="o">+</span><span class="n">a</span> <span class="c1"># function definition</span>
	<span class="k">if</span> <span class="n">numpy</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">ouv</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
		<span class="n">fit</span><span class="p">,</span><span class="n">cov</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">optimize</span><span class="o">.</span><span class="n">curve_fit</span><span class="p">(</span><span class="n">ff</span><span class="p">,</span> <span class="n">o</span><span class="o">.</span><span class="n">lognu</span><span class="p">[</span><span class="n">ouv</span><span class="p">],</span> <span class="n">o</span><span class="o">.</span><span class="n">ll</span><span class="p">[</span><span class="n">ouv</span><span class="p">],</span> <span class="n">p0</span><span class="o">=</span><span class="mf">8.</span><span class="p">)</span>
		<span class="n">m</span><span class="o">=</span><span class="n">fit</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
		<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;popstar mass = &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">m</span><span class="p">))</span>

		<span class="n">pylab</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xpop</span><span class="p">,</span><span class="n">ypop</span><span class="o">+</span><span class="n">m</span><span class="p">,</span><span class="s1">&#39;-&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>

		<span class="k">return</span> <span class="n">m</span></div>






<div class="viewcode-block" id="f"><a class="viewcode-back" href="../../nmmn.html#nmmn.sed.f">[docs]</a><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">xpop</span><span class="p">,</span><span class="n">ypop</span><span class="p">,</span><span class="n">x</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Given the spectrum of a popstar and an array of frequencies &#39;x&#39;,</span>
<span class="sd">this outputs the values of ypop for each x.</span>

<span class="sd">:param x: frequencies</span>
<span class="sd">:param xpop,ypop: spectrum from stellar population</span>
<span class="sd">:returns: returns y=a*L where L is the stellar pop. luminosity</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">i</span><span class="o">=</span><span class="n">lsd</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">xpop</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">ypop</span><span class="p">[</span><span class="n">i</span><span class="p">]</span></div>





<div class="viewcode-block" id="pionDecay"><a class="viewcode-back" href="../../nmmn.html#nmmn.sed.pionDecay">[docs]</a><span class="k">def</span> <span class="nf">pionDecay</span><span class="p">(</span><span class="n">logfile</span><span class="p">,</span> <span class="n">parfile</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">2.3</span><span class="p">,</span> <span class="n">E0</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">proton_energy</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">photon_energy</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">	</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Gamma-ray spectrum from a RIAF, pion 0 decay</span>
<span class="sd">=============================================</span>
<span class="sd">Computes the gamma-ray spectrum from pp collisions followed by pion decay for the full </span>
<span class="sd">RIAF computed by my semi-analytical model. </span>

<span class="sd">:param logfile: log file generated by the semi-analytical RIAF model, containing the electron number density and ion temperature. e.g. &#39;cd ~/science/projects/adafjet/adaf/perl/run01/out_01&#39;</span>
<span class="sd">:param parfile: parameter file used as input by the semi-analytical RIAF model, containing the black hole mass and other model parameters. e.g. &#39;cd ~/science/projects/adafjet/adaf/perl/run01/in.dat&#39;</span>
<span class="sd">:param alpha: power-law index</span>
<span class="sd">:param E0: reference energy. Default = proton_mass*c^2 ~ 1 GeV</span>
<span class="sd">:param proton_energy: array of proton energies, e.g. logspace(0, 6, 50) * astropy.units.MeV</span>
<span class="sd">:param photon_energy: array of photon energies for SED. If None, taken as the same as proton_energy. In astropy.units</span>

<span class="sd">:returns: SED object in units of Hz vs erg/s</span>

<span class="sd">Example:</span>

<span class="sd">Computes gamma-ray SED with default particle DF options and power-law index. Issue</span>
<span class="sd">the command below in the directory with model datafiles.</span>

<span class="sd">.. code-block:: python</span>

<span class="sd">    m=nmmn.sed.pionDecay(&#39;out_01&#39;,&#39;in.dat&#39;)</span>
<span class="sd">    plot(m.lognu,m.ll)</span>


<span class="sd">Based on the jupyter notebook &quot;gamma-rays RIAF&quot;. </span>

<span class="sd">References about pion decay physics:</span>
<span class="sd">• Oka &amp; Manmoto 2003: overview of calculation</span>
<span class="sd">• Fatuzzo &amp; Melia 2003: overview of calculation</span>
<span class="sd">• Dermer 1986: formulas</span>

<span class="sd">naima model:</span>
<span class="sd">• Kafexhiu, E., Aharonian, F., Taylor, A.M., &amp; Vila, G.S. 2014, Physical Review D, 90, 123014</span>
<span class="sd">• Zabalza 2015</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="kn">import</span> <span class="nn">naima</span>
	<span class="kn">from</span> <span class="nn">naima.models</span> <span class="kn">import</span> <span class="p">(</span><span class="n">ExponentialCutoffPowerLaw</span><span class="p">,</span> <span class="n">Synchrotron</span><span class="p">,</span>
							  <span class="n">InverseCompton</span><span class="p">)</span>
	<span class="kn">import</span> <span class="nn">astropy.units</span> <span class="k">as</span> <span class="nn">u</span>
	<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">misc</span> <span class="c1"># intrapackage reference</span>
	<span class="kn">import</span> <span class="nn">tqdm</span><span class="o">,</span> <span class="nn">re</span>


	<span class="c1"># Preliminaries</span>
	<span class="c1"># ==============</span>

	<span class="c1"># constants in CGS (everything in CGS unless otherwise noted)</span>
	<span class="n">k</span> <span class="o">=</span> <span class="mf">1.38065e-16</span> <span class="c1"># Boltzmann</span>
	<span class="n">mp</span><span class="o">=</span><span class="mf">1.67e-24</span> <span class="c1"># proton mass</span>
	<span class="n">c</span> <span class="o">=</span> <span class="mi">29979245800</span>
	<span class="n">mev</span> <span class="o">=</span> <span class="mf">1.6e-6</span> <span class="c1"># 1 MeV in erg</span>
	<span class="n">G</span> <span class="o">=</span> <span class="mf">6.673e-8</span> 
	<span class="n">solarmass</span> <span class="o">=</span> <span class="mf">1.99e33</span>
	<span class="n">planck</span><span class="o">=</span><span class="mf">6.62607e-27</span>	<span class="c1"># Planck constant </span>

	<span class="c1"># Input from RIAF model</span>
	<span class="c1"># ======================</span>

	<span class="c1"># ## reads files</span>
	<span class="c1">#</span>
	<span class="c1"># The RIAF model gives us the following variables:</span>
	<span class="c1"># </span>
	<span class="c1"># - electron number density $n_e(R)$ where $R$ is the cylindrical radius </span>
	<span class="c1"># - proton temperature $T_p(R)$</span>
	<span class="c1"># - scale height $H(R)$</span>
	<span class="n">r</span><span class="p">,</span><span class="n">ti</span><span class="p">,</span><span class="n">h</span><span class="p">,</span><span class="n">ne</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">logfile</span><span class="p">,</span><span class="n">unpack</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">usecols</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">14</span><span class="p">))</span>

	<span class="c1"># proton temperature</span>
	<span class="n">Tp</span><span class="o">=</span><span class="mi">10</span><span class="o">**</span><span class="n">ti</span>
	<span class="c1"># electron number density</span>
	<span class="n">ne</span><span class="o">=</span><span class="mi">10</span><span class="o">**</span><span class="n">ne</span>
	<span class="c1"># number of cylindrical shells in RIAF</span>
	<span class="n">nshells</span><span class="o">=</span><span class="n">r</span><span class="o">.</span><span class="n">size</span>

	<span class="c1"># ## gets BH mass from parameter file</span>
	<span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">parfile</span><span class="p">,</span><span class="s2">&quot;r&quot;</span><span class="p">)</span>

	<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
		<span class="c1"># if m=7.9d0 in the file</span>
		<span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;m=\d+\.d&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
			<span class="n">m</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\d+\.\d+d0&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">()</span>
			<span class="n">m</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;d&quot;</span><span class="p">,</span> <span class="s2">&quot;e&quot;</span><span class="p">,</span> <span class="n">m</span><span class="p">))</span> <span class="c1"># replaces d with e in the number for use in python</span>
		<span class="k">else</span><span class="p">:</span> 
			<span class="c1"># if m=7.9</span>
			<span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;m=\d+\.&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
				<span class="n">m</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\d+\.\d+&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">()</span>
				<span class="n">m</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="c1"># replaces d with e in the number for use in python</span>

	<span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

	<span class="n">m</span><span class="o">=</span><span class="n">m</span><span class="o">*</span><span class="mf">1e6</span> <span class="c1"># in solar masses</span>

	<span class="c1"># The quantity below is useful for converting from geometrized to physical units. Example: to convert radius `r` from geometrized units to physical units: </span>
	<span class="c1"># </span>
	<span class="c1">#     rphys=length*r</span>
	<span class="n">length</span><span class="o">=</span><span class="n">G</span><span class="o">*</span><span class="n">m</span><span class="o">*</span><span class="n">solarmass</span><span class="o">/</span><span class="n">c</span><span class="o">**</span><span class="mi">2</span>

	<span class="c1"># ## compute shells</span>
	<span class="c1"># </span>
	<span class="c1"># We need to convert the RIAF variables to:</span>
	<span class="c1"># </span>
	<span class="c1"># - proton number density $n_p$: assume $n_p(R)=n_e(R)$</span>
	<span class="c1"># - proton dimensionless temperature $\theta_p$</span>
	<span class="c1"># - volume of each shell $\Delta V (R)=4\pi R H \Delta R$ </span>
	<span class="c1"># </span>
	<span class="c1"># Everything in CGS unless otherwise noted.</span>

	<span class="c1"># thickness of each shell</span>
	<span class="n">dr</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nshells</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

	<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nshells</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
		<span class="n">dr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>

	<span class="c1"># repeats last element to ensure that r and dr have same number of elements and avoid headaches</span>
	<span class="n">dr</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dr</span><span class="p">,</span><span class="n">dr</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

	<span class="c1"># distances in physical units</span>
	<span class="n">rphys</span><span class="o">=</span><span class="n">r</span><span class="o">*</span><span class="n">length</span>	<span class="c1"># cylindrical radius</span>
	<span class="n">drphys</span><span class="o">=</span><span class="n">dr</span><span class="o">*</span><span class="n">length</span> <span class="c1"># thickness of each shell</span>
	<span class="n">hphys</span><span class="o">=</span><span class="n">h</span><span class="o">*</span><span class="n">length</span>	<span class="c1"># scale height</span>

	<span class="c1"># ## gets RIAF proton parameters</span>
	<span class="n">np</span><span class="o">=</span><span class="n">ne</span> <span class="c1"># proton number density</span>
	<span class="n">thetap</span><span class="o">=</span><span class="n">k</span><span class="o">*</span><span class="n">Tp</span><span class="o">/</span><span class="p">(</span><span class="n">mp</span><span class="o">*</span><span class="n">c</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>	<span class="c1"># k Tp/(mp c^2)</span>
	<span class="c1">#kTp=k*Tp # k Tp</span>
	<span class="n">dV</span><span class="o">=</span><span class="mi">4</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">rphys</span><span class="o">*</span><span class="n">hphys</span><span class="o">*</span><span class="n">drphys</span> 	<span class="c1"># volume of shells</span>

	<span class="c1"># Spectrum</span>
	<span class="c1"># =============</span>
	<span class="c1"># </span>
	<span class="c1"># ## particle distribution function</span>
	<span class="c1"># </span>
	<span class="c1"># Spectral parameters for the [Power Law model](https://naima.readthedocs.io/en/latest/api-models.html#naima.models.PowerLaw) </span>
	<span class="c1"># this is a list of amplitudes</span>
	<span class="n">amplitude</span> <span class="o">=</span> <span class="mf">1.5</span><span class="o">*</span><span class="p">(</span><span class="n">alpha</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">alpha</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">*</span><span class="n">thetap</span><span class="o">*</span><span class="n">dV</span><span class="o">/</span><span class="p">(</span><span class="n">mp</span><span class="o">*</span><span class="n">c</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="n">u</span><span class="o">.</span><span class="n">erg</span>
	<span class="c1">#e_cutoff = 80 * u.TeV</span>
	<span class="k">if</span> <span class="n">E0</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
		<span class="n">E0</span><span class="o">=</span><span class="n">mp</span><span class="o">*</span><span class="n">c</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">erg</span>

	<span class="k">if</span> <span class="n">proton_energy</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
		<span class="n">proton_energy</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">MeV</span>

	<span class="c1"># proton energy DF for each shell</span>
	<span class="n">PL</span><span class="o">=</span><span class="p">[]</span>

	<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nshells</span><span class="p">):</span>
		<span class="n">PL</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">naima</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">PowerLaw</span><span class="p">(</span><span class="n">amplitude</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">E0</span><span class="p">,</span> <span class="n">alpha</span><span class="p">))</span>

	<span class="c1"># ## pion decay</span>
	<span class="c1">#</span>
	<span class="c1"># computes pion decay model at each shell</span>
	<span class="n">pion</span><span class="o">=</span><span class="p">[]</span>

	<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nshells</span><span class="p">):</span>
		<span class="n">pion</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">naima</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">PionDecay</span><span class="p">(</span><span class="n">PL</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">nh</span><span class="o">=</span><span class="n">np</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">cm</span> <span class="o">**</span> <span class="o">-</span><span class="mi">3</span><span class="p">)</span> <span class="p">)</span>

	<span class="c1"># ## SED</span>
	<span class="k">if</span> <span class="n">photon_energy</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
		<span class="n">photon_energy</span> <span class="o">=</span> <span class="n">proton_energy</span>

	<span class="c1"># compute the radiative contribution of each shell</span>
	<span class="n">seds</span><span class="o">=</span><span class="p">[]</span>

	<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="o">.</span><span class="n">tqdm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">nshells</span><span class="p">),</span> <span class="s2">&quot;Computing gamma-ray spectrum&quot;</span><span class="p">):</span>
		<span class="n">seds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">pion</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">sed</span><span class="p">(</span><span class="n">photon_energy</span><span class="p">,</span> <span class="n">distance</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="p">)</span>

	<span class="c1"># sums up all shells in &quot;The SED&quot;</span>
	<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nshells</span><span class="p">):</span>
		<span class="k">if</span> <span class="n">i</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span> 
			<span class="n">thesed</span><span class="o">=</span><span class="n">seds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">thesed</span><span class="o">=</span><span class="n">thesed</span><span class="o">+</span><span class="n">seds</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

	<span class="c1"># frequency in Hz</span>
	<span class="n">nu</span><span class="o">=</span><span class="n">photon_energy</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">erg</span><span class="p">)</span><span class="o">.</span><span class="n">value</span><span class="o">/</span><span class="n">planck</span>
	<span class="c1"># luminosity in erg/s</span>
	<span class="n">nuLnu</span><span class="o">=</span><span class="n">thesed</span><span class="o">.</span><span class="n">value</span>

	<span class="c1"># returns SED object </span>
	<span class="k">return</span> <span class="n">SED</span><span class="p">(</span><span class="n">lognu</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">nu</span><span class="p">),</span> <span class="n">ll</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">nuLnu</span><span class="p">),</span> <span class="n">logfmt</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></div>



</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../index.html">nmmn</a></h1>








<h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../nmmn.html">nmmn package</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2016, Author.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 5.0.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
    </div>

    

    
  </body>
</html>